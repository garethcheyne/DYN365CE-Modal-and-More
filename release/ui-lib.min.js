!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).err403={})}(this,function(e){"use strict";var t;const n={colors:{primary:"#0078d4",primaryHover:"#106ebe",primaryPressed:"#005a9e",success:"#107c10",error:"#a80000",warning:"#f3f2f1",info:"#0078d4",neutralPrimary:"#323130",neutralSecondary:"#605e5c",neutralTertiary:"#a19f9d",neutralLight:"#edebe9",neutralLighter:"#f3f2f1",neutralLighterAlt:"#faf9f8",white:"#ffffff",toast:{success:{bg:"rgba(16, 124, 16, 0.9)",border:"#107c10",text:"#ffffff"},error:{bg:"rgba(168, 0, 0, 0.9)",border:"#a80000",text:"#ffffff"},warn:{bg:"rgba(255, 185, 0, 0.9)",border:"#ffb900",text:"#323130"},info:{bg:"rgba(0, 120, 212, 0.9)",border:"#0078d4",text:"#ffffff"},default:{bg:"rgba(50, 49, 48, 0.95)",border:"#323130",text:"#ffffff"}},modal:{background:"#ffffff",text:"#323130",textSecondary:"#605e5c",border:"#edebe9",overlay:"rgba(0, 0, 0, 0.4)",headerBackground:"#ffffff",footerBackground:"#ffffff",divider:"#edebe9",primary:"#0078d4",primaryHover:"#106ebe",primaryPressed:"#005a9e",primaryText:"#ffffff",secondary:"transparent",secondaryBorder:"#8a8886",secondaryText:"#323130",secondaryHover:"#f3f2f1",secondaryPressed:"#edebe9",danger:"#a80000",dangerHover:"#750b0b",dangerPressed:"#5a0000",dangerText:"#ffffff",inputBackground:"#faf9f8",inputBorder:"transparent",inputBorderBottom:"#8a8886",inputBorderHover:"#323130",inputBorderFocus:"#0078d4",inputText:"#323130",inputPlaceholder:"#605e5c",inputDisabled:"#f0f0f0",tabBorder:"#edebe9",tabActive:"#0078d4",tabActiveBorder:"#0078d4",tabInactive:"#323130",tabInactiveBorder:"transparent",tabHover:"#106ebe",tabBackground:"#ffffff",tabSelectedBackground:"#ffffff",progress:{bar:"#0078d4",barBackground:"#edebe9",stepActive:"#0078d4",stepCompleted:"#107c10",stepPending:"#d2d0ce",stepText:"#323130",stepBorder:"#8a8886"},sideCart:{background:"#faf9f8",border:"#edebe9",text:"#323130"}}},shadows:{toast:"0 0 2px rgba(0, 0, 0, 0.12), 0 2px 4px rgba(0, 0, 0, 0.14)",modal:"0 0 2px rgba(0, 0, 0, 0.12), 0 2px 4px rgba(0, 0, 0, 0.14)",dropdown:"0 0 2px rgba(0, 0, 0, 0.12), 0 2px 4px rgba(0, 0, 0, 0.14)",card:"0 0 2px rgba(0, 0, 0, 0.12), 0 2px 4px rgba(0, 0, 0, 0.14)",depth8:"0 0 2px rgba(0, 0, 0, 0.12), 0 2px 4px rgba(0, 0, 0, 0.14)",depth16:"0 0 2px rgba(0, 0, 0, 0.12), 0 2px 4px rgba(0, 0, 0, 0.14)",depth64:"0 0 2px rgba(0, 0, 0, 0.12), 0 2px 4px rgba(0, 0, 0, 0.14)"},borderRadius:{none:"0px",small:"4px",medium:"8px",large:"8px",circular:"50%"},typography:{fontFamily:"'Segoe UI', -apple-system, BlinkMacSystemFont, 'Roboto', 'Helvetica Neue', sans-serif",fontSize:{caption:"12px",body:"14px",subtitle:"16px",title:"18px",large:"20px",xLarge:"24px"},fontWeight:{regular:400,semibold:600,bold:700},lineHeight:{caption:"16px",body:"20px",subtitle:"22px",title:"24px"}},spacing:{none:"0px",xxs:"2px",xs:"4px",sNudge:"6px",s:"8px",mNudge:"10px",m:"12px",l:"16px",xl:"20px",xxl:"24px",xxxl:"32px"},zIndex:{toast:999999,modal:999998,modalOverlay:999997,dropdown:1e3}},o={slideInRight:"\n    @keyframes slideInRight {\n      from {\n        transform: translateX(100%);\n        opacity: 0;\n      }\n      to {\n        transform: translateX(0);\n        opacity: 1;\n      }\n    }\n  ",slideOutRight:"\n    @keyframes slideOutRight {\n      from {\n        transform: translateX(0);\n        opacity: 1;\n      }\n      to {\n        transform: translateX(100%);\n        opacity: 0;\n      }\n    }\n  ",fadeInScale:"\n    @keyframes fadeInScale {\n      from {\n        opacity: 0;\n        transform: translate(-50%, -50%) scale(0.9);\n      }\n      to {\n        opacity: 1;\n        transform: translate(-50%, -50%) scale(1);\n      }\n    }\n  ",fadeOutScale:"\n    @keyframes fadeOutScale {\n      from {\n        opacity: 1;\n        transform: translate(-50%, -50%) scale(1);\n      }\n      to {\n        opacity: 0;\n        transform: translate(-50%, -50%) scale(0.9);\n      }\n    }\n  ",fadeIn:"\n    @keyframes fadeIn {\n      from {\n        opacity: 0;\n      }\n      to {\n        opacity: 1;\n      }\n    }\n  ",fadeOut:"\n    @keyframes fadeOut {\n      from {\n        opacity: 1;\n      }\n      to {\n        opacity: 0;\n      }\n    }\n  ",spin:"\n    @keyframes spin {\n      from {\n        transform: rotate(0deg);\n      }\n      to {\n        transform: rotate(360deg);\n      }\n    }\n  ",progressFill:"\n    @keyframes progressFill {\n      from {\n        width: 0%;\n      }\n    }\n  "};function i(){const e="err403-animations";if(document.getElementById(e))return;const t=document.createElement("style");t.id=e,t.textContent=Object.values(o).join("\n"),document.head.appendChild(t)}const s=(()=>{let e=null;return()=>{if(e)return e;const t=document.getElementById("err403-toast-container");if(t)return e=t,e;e=document.createElement("div"),e.id="err403-toast-container",e.style.cssText=`\n    position: fixed;\n    top: 20px;\n    right: 20px;\n    z-index: ${n.zIndex.toast};\n    pointer-events: none;\n  `,i();return(window.parent?.document||document).body.appendChild(e),e}})();function r(e,t){const{title:o,message:i="",duration:r=6e3,sound:a=!1}=e,l=n.colors.toast[t],d=document.createElement("div");d.className="err403-toast",d.style.cssText=`\n    display: flex;\n    align-items: flex-start;\n    gap: 12px;\n    min-width: 300px;\n    max-width: 500px;\n    padding: 16px;\n    margin-bottom: 12px;\n    background: ${l.bg};\n    border-left: 4px solid ${l.border};\n    border-radius: ${n.borderRadius.medium};\n    box-shadow: ${n.shadows.toast};\n    color: ${l.text};\n    font-family: ${n.typography.fontFamily};\n    font-size: ${n.typography.fontSize.body};\n    pointer-events: all;\n    cursor: pointer;\n    animation: slideInRight 0.3s ease-out;\n    backdrop-filter: blur(10px);\n    transition: transform 0.2s ease, opacity 0.2s ease;\n  `;const c=document.createElement("div");c.style.cssText="\n    flex-shrink: 0;\n    margin-top: 2px;\n  ",c.innerHTML=function(e){return{success:'<svg width="20" height="20" viewBox="0 0 20 20" fill="none"><path d="M10 0C4.48 0 0 4.48 0 10s4.48 10 10 10 10-4.48 10-10S15.52 0 10 0zm-2 15l-5-5 1.41-1.41L8 12.17l7.59-7.59L17 6l-9 9z" fill="currentColor"/></svg>',error:'<svg width="20" height="20" viewBox="0 0 20 20" fill="none"><path d="M10 0C4.48 0 0 4.48 0 10s4.48 10 10 10 10-4.48 10-10S15.52 0 10 0zm1 15H9v-2h2v2zm0-4H9V5h2v6z" fill="currentColor"/></svg>',warn:'<svg width="20" height="20" viewBox="0 0 20 20" fill="none"><path d="M1 17h18L10 1 1 17zm10-2H9v-2h2v2zm0-4H9V7h2v4z" fill="currentColor"/></svg>',info:'<svg width="20" height="20" viewBox="0 0 20 20" fill="none"><path d="M10 0C4.48 0 0 4.48 0 10s4.48 10 10 10 10-4.48 10-10S15.52 0 10 0zm1 15H9V9h2v6zm0-8H9V5h2v2z" fill="currentColor"/></svg>',default:'<svg width="20" height="20" viewBox="0 0 20 20" fill="none"><circle cx="10" cy="10" r="9" stroke="currentColor" stroke-width="2" fill="none"/><circle cx="10" cy="10" r="3" fill="currentColor"/></svg>'}[e]}(t);const h=document.createElement("div");h.style.cssText="\n    flex: 1;\n    overflow: hidden;\n  ";const p=document.createElement("div");if(p.textContent=o,p.style.cssText=`\n    font-weight: ${n.typography.fontWeight.semibold};\n    margin-bottom: ${i?"4px":"0"};\n  `,h.appendChild(p),i){const e=document.createElement("div");e.textContent=i,e.style.cssText=`\n      font-size: ${n.typography.fontSize.caption};\n      opacity: 0.95;\n      word-wrap: break-word;\n    `,h.appendChild(e)}const u=document.createElement("button");u.innerHTML="Ã—",u.style.cssText=`\n    flex-shrink: 0;\n    background: none;\n    border: none;\n    color: ${l.text};\n    font-size: 24px;\n    line-height: 1;\n    cursor: pointer;\n    padding: 0;\n    width: 20px;\n    height: 20px;\n    opacity: 0.7;\n    transition: opacity 0.2s;\n  `,u.onmouseover=()=>u.style.opacity="1",u.onmouseout=()=>u.style.opacity="0.7",d.appendChild(c),d.appendChild(h),d.appendChild(u),d.onmouseover=()=>{d.style.transform="translateX(-4px)"},d.onmouseout=()=>{d.style.transform="translateX(0)"};const m={element:d,show(){s().appendChild(d),a&&function(e){if("success"===e||"error"===e)try{const t=new(window.AudioContext||window.webkitAudioContext),n=t.createOscillator(),o=t.createGain();n.connect(o),o.connect(t.destination),n.frequency.value="success"===e?800:400,n.type="sine",o.gain.setValueAtTime(.1,t.currentTime),o.gain.exponentialRampToValueAtTime(.01,t.currentTime+.1),n.start(t.currentTime),n.stop(t.currentTime+.1)}catch(t){}}(t),r>0&&setTimeout(()=>{this.close()},r)},close(){d.style.animation="slideOutRight 0.3s ease-in",setTimeout(()=>{d.parentElement&&d.parentElement.removeChild(d)},300)}};return d.onclick=e=>{e.target!==u&&m.close()},u.onclick=e=>{e.stopPropagation(),m.close()},m}const a={success(e,t,n,o){const i=r("string"==typeof e?{title:e,message:t,duration:n,sound:o}:{...e},"success");return i.show(),i},error(e,t,n,o){const i=r("string"==typeof e?{title:e,message:t,duration:n,sound:o}:{...e},"error");return i.show(),i},warn(e,t,n,o){const i=r("string"==typeof e?{title:e,message:t,duration:n,sound:o}:{...e},"warn");return i.show(),i},info(e,t,n,o){const i=r("string"==typeof e?{title:e,message:t,duration:n,sound:o}:{...e},"info");return i.show(),i},default(e,t,n,o){const i=r("string"==typeof e?{title:e,message:t,duration:n,sound:o}:{...e},"default");return i.show(),i}};class l{constructor(e,t,n=!1,o=!1,i=!1){this.label=e,this.callback=t,this.setFocus=n,this.preventClose=o,this.isDestructive=i}}function d(){try{if(window.self!==window.top&&window.top)return window.top.document}catch(e){}return document}let c=class e{constructor(e){this.overlay=null,this.container=null,this.modal=null,this.header=null,this.body=null,this.footer=null,this.loadingOverlay=null,this.resolvePromise=null,this.fieldValues=new Map,this.currentStep=1,this.isDragging=!1,this.dragStartX=0,this.dragStartY=0,this.modalStartX=0,this.modalStartY=0,this.handleDrag=e=>{if(!this.isDragging||!this.container)return;const t=e.clientX-this.dragStartX,n=e.clientY-this.dragStartY,o=this.modalStartX+t,i=this.modalStartY+n;this.container.style.transform="none",this.container.style.left=`${o}px`,this.container.style.top=`${i}px`,this.container.style.margin="0"},this.stopDrag=()=>{this.isDragging=!1;const e=d();e.removeEventListener("mousemove",this.handleDrag),e.removeEventListener("mouseup",this.stopDrag)},this.handleEscapeKey=e=>{"Escape"===e.key&&this.options.allowEscapeClose&&this.close()},this.options={preventClose:!1,allowDismiss:!0,allowEscapeClose:!0,draggable:!1,buttonAlignment:"right",autoSave:!1,size:"medium",...e},this.createModal()}createModal(){const e=d();i(),this.overlay=e.createElement("div"),this.overlay.style.cssText=`\n      position: fixed;\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: 100%;\n      background: ${n.colors.modal.overlay};\n      z-index: ${n.zIndex.modalOverlay};\n      animation: fadeIn 0.2s ease-out;\n    `,this.options.allowDismiss&&(this.overlay.onclick=()=>this.close()),this.container=e.createElement("div"),this.container.style.cssText=`\n      position: fixed;\n      top: 50%;\n      left: 50%;\n      transform: translate(-50%, -50%);\n      z-index: ${n.zIndex.modal};\n      animation: fadeInScale 0.3s ease-out;\n    `,this.container.onclick=e=>e.stopPropagation(),this.modal=e.createElement("div");const{width:t,height:o}=this.getModalDimensions();if(this.modal.style.cssText=`\n      background: #fafafa;\n      border-radius: ${n.borderRadius.medium};\n      box-shadow: ${n.shadows.modal};\n      width: ${t}px;\n      max-width: 95vw;\n      ${o?`height: ${o}px; max-height: 90vh;`:"max-height: 90vh;"}\n      display: flex;\n      flex-direction: column;\n      overflow: hidden;\n    `,this.createHeader(),this.createBody(),this.modal.appendChild(this.body),this.createFooter(),this.options.sideCart?.enabled){const t=!0===this.options.sideCart.attached,n=e.createElement("div");n.style.cssText=`\n        display: flex;\n        ${"left"===this.options.sideCart.position?"flex-direction: row-reverse;":"flex-direction: row;"}\n        align-items: stretch;\n        ${t?"":"gap: 18px;"}\n      `;const o=this.createSideCart();n.appendChild(this.modal),o&&n.appendChild(o),this.container.appendChild(n)}else this.container.appendChild(this.modal);this.options.allowEscapeClose&&e.addEventListener("keydown",this.handleEscapeKey)}getModalDimensions(){if(this.options.width)return{width:this.options.width,height:this.options.height||null};const e={small:{width:400,height:null},medium:{width:600,height:null},large:{width:900,height:null},fullscreen:{width:.95*window.innerWidth,height:.9*window.innerHeight}};return e[this.options.size||"medium"]||e.medium}createHeader(){const e=d();this.header=e.createElement("div"),this.header.style.cssText=`\n      padding: ${n.spacing.l};\n      border-bottom: 1px solid rgb(239, 239, 239);\n      background: #ffffff;\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n      flex-shrink: 0;\n      ${this.options.draggable?"cursor: move;":""}\n    `;const t=e.createElement("h2");if(t.textContent=this.options.title,t.style.cssText=`\n      margin: 0;\n      font-size: ${n.typography.fontSize.title};\n      font-weight: ${n.typography.fontWeight.semibold};\n      color: ${n.colors.modal.text};\n    `,this.header.appendChild(t),!this.options.preventClose){const t=e.createElement("button");t.innerHTML="Ã—",t.setAttribute("aria-label","Close"),t.style.cssText=`\n        background: none;\n        border: none;\n        font-size: 32px;\n        line-height: 1;\n        color: ${n.colors.modal.textSecondary};\n        cursor: pointer;\n        padding: 0;\n        width: 32px;\n        height: 32px;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        transition: color 0.2s;\n      `,t.onmouseover=()=>t.style.color=n.colors.modal.text,t.onmouseout=()=>t.style.color=n.colors.modal.textSecondary,t.onclick=()=>this.close(),this.header.appendChild(t)}this.options.draggable&&this.header&&(this.header.onmousedown=e=>this.startDrag(e)),this.modal.appendChild(this.header)}createBody(){const e=d();this.body=e.createElement("div");const t=(this.options.message?1:0)+(this.options.content?1:0)+(this.options.fields&&this.options.fields.length>0?1:0)>1;if(this.body.style.cssText=`\n      flex: 1;\n      overflow: auto;\n      padding: ${n.spacing.l};\n      background: ${t?"#fafafa":"#ffffff"};\n    `,this.options.message){const o=e.createElement("p");o.textContent=this.options.message,o.style.cssText=`\n        margin: 0 0 ${t?n.spacing.m:"0"} 0;\n        color: ${n.colors.modal.textSecondary};\n        font-size: ${n.typography.fontSize.body};\n        ${t?`\n          background: #ffffff;\n          padding: ${n.spacing.l};\n          border-radius: ${n.borderRadius.medium};\n          box-shadow: rgba(0, 0, 0, 0.12) 0px 0px 2px, rgba(0, 0, 0, 0.14) 0px 2px 4px;\n        `:""}\n      `,this.body.appendChild(o)}if(this.options.content){const o=e.createElement("div");o.innerHTML=this.options.content,o.style.cssText=`\n        ${t?`\n          background: #ffffff;\n          padding: ${n.spacing.l};\n          border-radius: ${n.borderRadius.medium};\n          box-shadow: rgba(0, 0, 0, 0.12) 0px 0px 2px, rgba(0, 0, 0, 0.14) 0px 2px 4px;\n        `:""}\n        margin-bottom: ${this.options.fields&&this.options.fields.length>0?n.spacing.m:"0"};\n      `,this.body.appendChild(o)}if(this.options.fields&&this.options.fields.length>0){const o=e.createElement("div");o.style.cssText=`\n        display: flex;\n        flex-direction: column;\n        gap: ${n.spacing.m};\n        ${t?`\n          background: #ffffff;\n          padding: ${n.spacing.l};\n          border-radius: ${n.borderRadius.medium};\n          box-shadow: rgba(0, 0, 0, 0.12) 0px 0px 2px, rgba(0, 0, 0, 0.14) 0px 2px 4px;\n        `:`\n          background: #fafafa;\n          padding: ${n.spacing.l};\n          border-radius: ${n.borderRadius.medium};\n        `}\n      `,this.options.fields.forEach(e=>{const t=this.createField(e);t&&o.appendChild(t)}),this.body.appendChild(o)}}createSideCart(){if(!this.options.sideCart?.enabled)return null;const e=d(),t=e.createElement("div"),o=this.options.sideCart.width||300,i=!0===this.options.sideCart.attached;if(t.style.cssText=`\n      width: ${o}px;\n      flex-shrink: 0;\n      background: ${this.options.sideCart.backgroundColor||"#ffffff"};\n      overflow: auto;\n      border-radius: ${n.borderRadius.medium};\n      ${i?"":`box-shadow: ${n.shadows.modal};`}\n    `,this.options.sideCart.content)t.innerHTML=this.options.sideCart.content;else if(this.options.sideCart.imageUrl){const n=e.createElement("img");n.src=this.options.sideCart.imageUrl,n.style.cssText="\n        width: 100%;\n        height: auto;\n        display: block;\n      ",t.appendChild(n)}return t}createTabs(e){const t=d(),o=t.createElement("div");o.style.cssText=`\n      display: flex;\n      flex-direction: column;\n      gap: ${n.spacing.m};\n    `;const i=t.createElement("div");i.setAttribute("role","presentation"),i.style.cssText="\n      min-height: 51px;\n      border-bottom: 2px solid rgb(239, 239, 239);\n    ";const s=t.createElement("ul");s.setAttribute("role","tablist"),s.style.cssText="\n      display: flex;\n      gap: 0;\n      list-style: none;\n      margin: 0;\n      padding: 0;\n      padding-bottom: 5px;\n    ";const r=t.createElement("div");r.style.cssText="\n      position: relative;\n      min-height: 0;\n    ";const a=[];return e.forEach((e,o)=>{const i=t.createElement("li");i.setAttribute("role","tab"),i.setAttribute("aria-selected",0===o?"true":"false"),i.setAttribute("aria-label",e.label||`Tab ${o+1}`),i.setAttribute("tabindex",0===o?"0":"-1"),i.textContent=e.label||`Tab ${o+1}`,i.style.cssText=`\n        padding: 0 0 0 0;\n        margin-right: 20px;\n        background: transparent;\n        border: none;\n        cursor: pointer;\n        font-size: 14px;\n        color: #000;\n        font-weight: ${0===o?"bold":"normal"};\n        line-height: 28px;\n        border-radius: 0;\n        position: relative;\n      `;const l=t.createElement("div");l.setAttribute("aria-hidden","true"),l.style.cssText="\n        position: absolute;\n        bottom: -7px;\n        left: 50%;\n        transform: translateX(-50%) scaleX(0);\n        height: 3px;\n        background-color: #0078d4;\n        transition: transform 0.15s ease-out;\n        transform-origin: center;\n        border-radius: 2px 2px 0 0;\n      ",i.appendChild(l);const d=t.createElement("div");d.style.cssText=`\n        display: ${0===o?"flex":"none"};\n        flex-direction: column;\n        gap: ${n.spacing.m};\n        padding: ${n.spacing.m} 0;\n      `,e.fields&&e.fields.forEach(e=>{const t=this.createField(e);t&&d.appendChild(t)}),a.push(d),i.onclick=()=>{a.forEach(e=>{e.style.display="none"}),Array.from(s.children).forEach(e=>{const t=e;t.style.fontWeight="normal",t.setAttribute("aria-selected","false"),t.setAttribute("tabindex","-1");const n=t.querySelector("div");n&&(n.style.transform="translateX(-50%) scaleX(0)")}),d.style.display="flex",i.style.fontWeight="bold",i.setAttribute("aria-selected","true"),i.setAttribute("tabindex","0");const e=i.offsetWidth,t=i.querySelector("div");t&&(t.style.width=`${e+2}px`,t.style.transform="translateX(-50%) scaleX(1)")},0===o&&(i.style.fontWeight="bold",setTimeout(()=>{const e=i.offsetWidth,t=i.querySelector("div");t&&(t.style.width=`${e+2}px`,t.style.transform="translateX(-50%) scaleX(1)")},0)),s.appendChild(i),r.appendChild(d)}),i.appendChild(s),o.appendChild(i),o.appendChild(r),setTimeout(()=>{let e=0;a.forEach(t=>{const n=t.style.display;t.style.display="flex";const o=t.scrollHeight;o>e&&(e=o),t.style.display=n}),e>0&&(r.style.minHeight=`${e}px`)},0),o}createField(e){const t=d();if(e.asTabs&&e.fields)return this.createTabs(e.fields);if("custom"===e.type){if(e.render)return e.render();if(e.html){const n=t.createElement("div");return n.innerHTML=e.html,n}return null}const o=t.createElement("div"),i=e.labelPosition||"left";if(o.style.cssText=`\n      display: flex;\n      flex-direction: ${"top"===i?"column":"row"};\n      gap: ${"top"===i?n.spacing.xs:n.spacing.m};\n      align-items: ${"top"===i?"stretch":"center"};\n    `,e.label){const s=t.createElement("label");s.textContent=e.label+(e.required?" *":""),s.style.cssText=`\n        display: block;\n        margin-bottom: ${"top"===i?"4px":"0"};\n        font-style: normal;\n        font-variant: normal;\n        font-weight: normal;\n        font-size: 14px;\n        font-family: 'SegoeUI', 'Segoe UI', ${n.typography.fontFamily};\n        color: ${n.colors.modal.text};\n        ${"left"===i?"min-width: 120px; flex-shrink: 0;":""}\n      `,o.appendChild(s)}let s;switch(e.type){case"textarea":s=t.createElement("textarea"),s.rows=e.rows||4,s.setAttribute("autocomplete","off"),s.setAttribute("autocorrect","off"),s.setAttribute("autocapitalize","off"),s.setAttribute("spellcheck","false");break;case"select":s=t.createElement("select"),s.setAttribute("autocomplete","off"),e.options&&e.options.forEach(e=>{const n=t.createElement("option");"string"==typeof e?(n.value=e,n.textContent=e):(n.value=e.value,n.textContent=e.label),s.appendChild(n)});break;default:s=t.createElement("input"),s.type=e.type||"text",s.setAttribute("autocomplete","off"),s.setAttribute("autocorrect","off"),s.setAttribute("autocapitalize","off"),s.setAttribute("spellcheck","false"),e.placeholder&&(s.placeholder=e.placeholder)}s.id=e.id;const r="checkbox"!==e.type&&"range"!==e.type,a=t.createElement("div");if(a.style.cssText=`\n      position: relative;\n      width: 100%;\n      ${"left"===i?"flex: 1;":""}\n    `,s.style.cssText=`\n      width: 100%;\n      padding: 8px 8px 6px 8px;\n      background-color: white;\n      border: none;\n      border-bottom: 1px solid rgb(216, 216, 216);\n      border-radius: 2px 2px 0 0;\n      font-size: 14px;\n      font-family: ${n.typography.fontFamily};\n      color: ${n.colors.modal.inputText};\n      outline: none;\n      min-height: 32px;\n      box-sizing: border-box;\n    `,r){const e=t.createElement("div");e.style.cssText="\n        position: absolute;\n        left: -1px;\n        right: -1px;\n        bottom: 0;\n        height: 2px;\n        background-color: #0078d4;\n        transform: scaleX(0);\n        transition: transform 0.15s ease-out;\n        border-radius: 0 0 4px 4px;\n        pointer-events: none;\n      ",s.onfocus=()=>{e.style.transform="scaleX(1)"},s.onblur=()=>{e.style.transform="scaleX(0)"},a.appendChild(e)}return void 0!==e.value&&(s instanceof HTMLInputElement&&"checkbox"===s.type?s.checked=Boolean(e.value):s.value=String(e.value),this.fieldValues.set(e.id,e.value)),s.oninput=()=>{s instanceof HTMLInputElement&&"checkbox"===s.type?this.fieldValues.set(e.id,s.checked):this.fieldValues.set(e.id,s.value)},a.appendChild(s),o.appendChild(a),o}createFooter(){const e=d();this.footer=e.createElement("div");const t=this.options.buttonAlignment||"right",o="space-between"===t?"space-between":"center"===t?"center":"left"===t?"flex-start":"flex-end";this.footer.style.cssText=`\n      padding: ${n.spacing.l};\n      border-top: 1px solid rgb(239, 239, 239);\n      background: #ffffff;\n      display: flex;\n      justify-content: ${o};\n      gap: ${n.spacing.m};\n      flex-shrink: 0;\n    `,this.options.buttons&&this.options.buttons.length>0&&this.options.buttons.forEach(e=>{const t=this.createButton(e);this.footer.appendChild(t)}),this.modal.appendChild(this.footer)}createButton(e){const t=d().createElement("button");t.textContent=e.label;const o=e.setFocus;return t.style.cssText=`\n      padding: 5px 12px;\n      background: ${o?n.colors.modal.primary:n.colors.modal.secondary};\n      border: ${o?"none":`1px solid ${n.colors.modal.secondaryBorder}`};\n      border-radius: ${n.borderRadius.small};\n      color: ${o?n.colors.modal.primaryText:n.colors.modal.secondaryText};\n      font-size: ${n.typography.fontSize.body};\n      font-weight: ${n.typography.fontWeight.semibold};\n      font-family: ${n.typography.fontFamily};\n      cursor: pointer;\n      transition: all 0.2s;\n      min-height: 32px;\n      min-width: 96px;\n    `,t.onmouseover=()=>{t.style.background=o?n.colors.modal.primaryHover:n.colors.modal.secondaryHover},t.onmouseout=()=>{t.style.background=o?n.colors.modal.primary:n.colors.modal.secondary},t.onclick=async()=>{!1===await e.callback()||e.preventClose||(this.resolvePromise&&this.resolvePromise({button:e,data:this.getFieldValues()}),this.close())},e.setFocus&&setTimeout(()=>t.focus(),100),t}startDrag(e){if(!this.options.draggable||!this.container)return;this.isDragging=!0,this.dragStartX=e.clientX,this.dragStartY=e.clientY;const t=this.container.getBoundingClientRect();this.modalStartX=t.left,this.modalStartY=t.top;const n=d();n.addEventListener("mousemove",this.handleDrag),n.addEventListener("mouseup",this.stopDrag),e.preventDefault()}show(){const e=d();this.overlay&&this.container&&(e.body.appendChild(this.overlay),e.body.appendChild(this.container),e.body.style.overflow="hidden")}showAsync(){return new Promise(e=>{this.resolvePromise=e,this.show()})}close(){const e=d();e.removeEventListener("keydown",this.handleEscapeKey),e.removeEventListener("mousemove",this.handleDrag),e.removeEventListener("mouseup",this.stopDrag),this.container&&(this.container.style.animation="fadeOutScale 0.2s ease-in"),this.overlay&&(this.overlay.style.animation="fadeOut 0.2s ease-in"),setTimeout(()=>{this.container?.parentElement&&this.container.parentElement.removeChild(this.container),this.overlay?.parentElement&&this.overlay.parentElement.removeChild(this.overlay),e.body.style.overflow=""},200)}setLoading(e,t){const o=d();if(e){if(!this.loadingOverlay&&this.modal){this.loadingOverlay=o.createElement("div"),this.loadingOverlay.style.cssText=`\n          position: absolute;\n          top: 0;\n          left: 0;\n          width: 100%;\n          height: 100%;\n          background: rgba(255, 255, 255, 0.9);\n          display: flex;\n          flex-direction: column;\n          align-items: center;\n          justify-content: center;\n          gap: ${n.spacing.m};\n          z-index: 10;\n        `;const e=o.createElement("div");if(e.style.cssText=`\n          width: 48px;\n          height: 48px;\n          border: 4px solid ${n.colors.modal.divider};\n          border-top-color: ${n.colors.modal.primary};\n          border-radius: 50%;\n          animation: spin 1s linear infinite;\n        `,this.loadingOverlay.appendChild(e),t){const e=o.createElement("div");e.textContent=t,e.style.cssText=`\n            color: ${n.colors.modal.text};\n            font-size: ${n.typography.fontSize.body};\n          `,this.loadingOverlay.appendChild(e)}this.modal.appendChild(this.loadingOverlay)}}else this.loadingOverlay?.parentElement&&(this.loadingOverlay.parentElement.removeChild(this.loadingOverlay),this.loadingOverlay=null)}updateProgress(e,t){this.currentStep=e}nextStep(){this.currentStep++,this.updateProgress(this.currentStep)}previousStep(){this.currentStep>1&&(this.currentStep--,this.updateProgress(this.currentStep))}goToStep(e){}getFieldValue(e){return this.fieldValues.get(e)}getFieldValues(){const e={};return this.fieldValues.forEach((t,n)=>{e[n]=t}),e}validateCurrentStep(){return!0}validateAllFields(){return!0}updateSideCart(e){}clearAutoSave(){}getElement(e){if(!e)return this.modal;if(this.modal){const t=this.modal.querySelectorAll(e);return 1===t.length?t[0]:Array.from(t)}return null}title(e){if(this.options.title=e,this.header){const t=this.header.querySelector("h2");t&&(t.textContent=e)}return this}message(e){return this.options.message=e,this}content(e){return this.options.content=e,this}width(e){return this.options.width=e,this.modal&&(this.modal.style.width=`${e}px`),this}height(e){return this.options.height=e,this.modal&&(this.modal.style.height=`${e}px`),this}static open(t){const n=new e(t);return n.show(),n}static alert(t,n,o){return new Promise(i=>{e.open({title:t,message:n,size:"small",...o,buttons:[new l("OK",()=>{i()},!0)]})})}static confirm(t,n,o){return new Promise(i=>{e.open({title:t,message:n,size:"small",...o,buttons:[new l("Cancel",()=>{i(!1)}),new l("OK",()=>{i(!0)},!0)]})})}showWebResource(e){const t=d();if(!this.body)return;this.body.innerHTML="",this.body.style.cssText="\n      flex: 1;\n      overflow: hidden;\n      padding: 0;\n      background: #ffffff;\n    ";const n=t.createElement("iframe");n.style.cssText="\n      width: 100%;\n      height: 100%;\n      border: none;\n      display: block;\n    ";const o=window.location.origin,i=e.startsWith("http")?e:`${o}/WebResources/${e}`;n.src=i,this.body.appendChild(n),this.overlay?.parentElement||this.show()}};const h=class{};const p=Object.freeze(Object.defineProperty({__proto__:null,alert:function(e,t,n){return new Promise(o=>{new h({title:e,message:t,icon:n?.icon||"INFO",size:"small",...n,buttons:[new l("OK",()=>o(),!0)]}).show()})},confirm:function(e,t,n){return new Promise(o=>{new h({title:e,message:t,icon:n?.icon||"QUESTION",size:"small",...n,buttons:[new l("Cancel",()=>o(!1)),new l("OK",()=>o(!0),!0)]}).show()})},prompt:function(e,t,n,o){return new Promise(i=>{const s=new h({title:e,message:t,icon:o?.icon||"QUESTION",size:"small",...o,fields:[{id:"promptValue",type:"text",value:n||"",placeholder:"Enter value..."}],buttons:[new l("Cancel",()=>i(null)),new l("OK",()=>{const e=s.getFieldValue("promptValue");i(e||"")},!0)]});s.show()})}},Symbol.toStringTag,{value:"Module"}));function u(){try{if(window.self!==window.top&&window.top)return window.top.document}catch(e){}return document}const m=new Map;async function f(e,t,n,o,i=1,s=50,r,a){if("undefined"!=typeof window&&window.Xrm?.WebApi?.retrieveMultipleRecords)try{const l=[...new Set([...t,...a||[]])];let d=`<fetch mapping='logical' page='${i}' count='${s}' returntotalrecordcount='true'>\n        <entity name='${e}'>`;l.forEach(e=>{d+=`<attribute name='${e}' />`});let c="";if(r&&a&&a.length>0){let e='<filter type="or">';a.forEach(t=>{e+=`<condition attribute='${t}' operator='like' value='%${r}%' />`}),e+="</filter>",c=n?`<filter type="and">${e}${n}</filter>`:e}else n&&(c=n);c&&(d+=c),o&&o.length>0&&o.forEach(e=>{d+=`<order attribute='${e.attribute}' ${e.descending?"descending='true'":""} />`}),d+="</entity></fetch>";const h=await window.Xrm.WebApi.retrieveMultipleRecords(e,`?fetchXml=${encodeURIComponent(d)}`);return{entities:h.entities||[],totalCount:parseInt(h["@Microsoft.Dynamics.CRM.totalrecordcount"]||h.entities?.length||"0",10)}}catch(p){console.warn(`Failed to fetch ${e} records via Xrm.WebApi:`,p)}console.log(`Using mock data for entity: ${e}`);const l=function(e,t=50){const n=[],o=["John","Jane","Michael","Sarah","David","Emily","Robert","Lisa","William","Jennifer"],i=["Smith","Johnson","Williams","Brown","Jones","Garcia","Miller","Davis","Rodriguez","Martinez"],s=["Acme Corp","TechCo","Global Industries","Innovation Labs","Premier Solutions","Summit Group","Venture Partners","Elite Services"],r=["New York","Los Angeles","Chicago","Houston","Phoenix","Philadelphia","San Antonio","San Diego"];for(let a=0;a<t;a++){const t=`${a+1}`.padStart(8,"0")+"-0000-0000-0000-000000000000";if("account"===e){const e=s[a%s.length];n.push({accountid:t,name:`${e} ${a>7?a-7:""}`.trim(),accountnumber:`ACC-${1e3+a}`,telephone1:`555-${Math.floor(900*Math.random()+100)}-${Math.floor(9e3*Math.random()+1e3)}`,emailaddress1:`contact@${e.toLowerCase().replace(/\s/g,"")}.com`,address1_city:r[a%r.length],revenue:Math.floor(1e7*Math.random()),websiteurl:`https://www.${e.toLowerCase().replace(/\s/g,"")}.com`,createdon:new Date(Date.now()-365*Math.random()*24*60*60*1e3).toISOString()})}else if("contact"===e){const e=o[a%o.length],r=i[Math.floor(a/o.length)%i.length];n.push({contactid:t,fullname:`${e} ${r}`,name:`${e} ${r}`,firstname:e,lastname:r,emailaddress1:`${e.toLowerCase()}.${r.toLowerCase()}@example.com`,telephone1:`555-${Math.floor(900*Math.random()+100)}-${Math.floor(9e3*Math.random()+1e3)}`,jobtitle:["Manager","Director","VP","Analyst","Specialist"][a%5],parentcustomerid:s[a%s.length],createdon:new Date(Date.now()-365*Math.random()*24*60*60*1e3).toISOString()})}else n.push({[`${e}id`]:t,name:`${e.charAt(0).toUpperCase()+e.slice(1)} Record ${a+1}`,createdon:new Date(Date.now()-365*Math.random()*24*60*60*1e3).toISOString()})}return n}(e,100);let d=l;if(r&&a&&a.length>0){const e=r.toLowerCase();d=l.filter(t=>a.some(n=>{const o=t[n];return null!=o&&String(o).toLowerCase().includes(e)}))}if(o&&o.length>0){const e=o[0];d.sort((t,n)=>{const o=t[e.attribute],i=n[e.attribute],s=o>i?1:o<i?-1:0;return e.descending?-s:s})}const c=(i-1)*s,h=c+s;return{entities:d.slice(c,h),totalCount:d.length}}let g=((t=class{constructor(e){this.tableContainer=null,this.tableBody=null,this.searchInput=null,this.paginationInfo=null,this.currentPage=1,this.totalRecords=0,this.records=[],this.allLoadedRecords=[],this.selectedRecords=new Set,this.searchDebounceTimer=0,this.columnLabels=new Map,this.sortColumn=null,this.sortDescending=!1,this.isLoadingMore=!1,this.hasMoreRecords=!0,this.options={entity:e.entity||"account",columns:e.columns,columnLabels:e.columnLabels||{},filters:e.filters||"",orderBy:e.orderBy||[],multiSelect:e.multiSelect??!1,searchFields:e.searchFields||e.columns,additionalSearchFields:e.additionalSearchFields||[],defaultSearchTerm:e.defaultSearchTerm||"",title:e.title||`Select ${e.entity?.charAt(0).toUpperCase()}${e.entity?.slice(1)}`,width:e.width||900,height:e.height||600,pageSize:e.pageSize||50,showPagination:e.showPagination??!0,allowClear:e.allowClear??!1,onSelect:e.onSelect,onCancel:e.onCancel||(()=>{})};const t=u();this.overlay=t.createElement("div"),this.overlay.style.cssText=`\n      position: fixed;\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: 100%;\n      background: ${n.colors.modal.overlay};\n      z-index: ${n.zIndex.modal-1};\n      animation: fadeIn 0.2s ease-out;\n    `,this.container=t.createElement("div"),this.container.style.cssText=`\n      position: fixed;\n      top: 50%;\n      left: 50%;\n      transform: translate(-50%, -50%);\n      z-index: ${n.zIndex.modal};\n      animation: fadeInScale 0.3s ease-out;\n    `,this.modal=t.createElement("div"),this.modal.style.cssText=`\n      background: ${n.colors.modal.background};\n      border-radius: ${n.borderRadius.medium};\n      box-shadow: ${n.shadows.modal};\n      width: ${this.options.width}px;\n      max-width: 95vw;\n      height: ${this.options.height}px;\n      max-height: 90vh;\n      display: flex;\n      flex-direction: column;\n      overflow: hidden;\n    `,this.container.appendChild(this.modal),this.render()}async render(){const e=this.createHeader();this.modal.appendChild(e);const t=this.createSearchBar();this.modal.appendChild(t);const n=this.createTableContainer();if(this.modal.appendChild(n),this.options.showPagination){const e=this.createPagination();this.modal.appendChild(e)}const o=this.createFooter();this.modal.appendChild(o),await this.loadColumnLabels(),await this.loadData()}createHeader(){const e=u().createElement("div");e.style.cssText=`\n      padding: ${n.spacing.l};\n      border-bottom: 1px solid ${n.colors.modal.divider};\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n      flex-shrink: 0;\n    `;const t=u().createElement("h2");t.textContent=this.options.title,t.style.cssText=`\n      margin: 0;\n      font-size: ${n.typography.fontSize.title};\n      font-weight: ${n.typography.fontWeight.semibold};\n      color: ${n.colors.modal.text};\n    `;const o=u().createElement("button");return o.innerHTML="Ã—",o.style.cssText=`\n      background: none;\n      border: none;\n      font-size: 32px;\n      line-height: 1;\n      color: ${n.colors.modal.textSecondary};\n      cursor: pointer;\n      padding: 0;\n      width: 32px;\n      height: 32px;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      transition: color 0.2s;\n    `,o.onmouseover=()=>o.style.color=n.colors.modal.text,o.onmouseout=()=>o.style.color=n.colors.modal.textSecondary,o.onclick=()=>this.cancel(),e.appendChild(t),e.appendChild(o),e}createSearchBar(){const e=u().createElement("div");e.style.cssText=`\n      padding: ${n.spacing.m} ${n.spacing.l};\n      border-bottom: 1px solid ${n.colors.modal.divider};\n      flex-shrink: 0;\n    `;const t=u().createElement("div");t.style.cssText="\n      position: relative;\n      width: 100%;\n      display: flex;\n      align-items: center;\n    ";const o=u().createElement("span");o.innerHTML="ðŸ”",o.style.cssText=`\n      position: absolute;\n      left: ${n.spacing.s};\n      top: 50%;\n      transform: translateY(-50%);\n      font-size: 16px;\n      color: ${n.colors.modal.textSecondary};\n      pointer-events: none;\n      z-index: 1;\n    `,this.searchInput=u().createElement("input"),this.searchInput.type="text",this.searchInput.placeholder="Search...",this.searchInput.value=this.options.defaultSearchTerm,this.searchInput.style.cssText=`\n      width: 100%;\n      padding: ${n.spacing.s} ${n.spacing.m};\n      padding-left: 36px;\n      background-color: ${n.colors.modal.inputBackground};\n      border: none;\n      border-bottom: 1px solid ${n.colors.modal.inputBorderBottom};\n      border-radius: ${n.borderRadius.small};\n      font-size: ${n.typography.fontSize.body};\n      font-family: ${n.typography.fontFamily};\n      color: ${n.colors.modal.inputText};\n      outline: none;\n      min-height: 32px;\n      box-sizing: border-box;\n    `;const i=u().createElement("div");return i.style.cssText=`\n      content: "";\n      position: absolute;\n      right: -1px;\n      left: -1px;\n      bottom: 0;\n      height: 2px;\n      background-color: ${n.colors.modal.inputBorderFocus};\n      transform: scaleX(0);\n      transition: transform 0.01ms;\n      transition-delay: 0.01ms;\n      border-bottom-left-radius: 4px;\n      border-bottom-right-radius: 4px;\n      pointer-events: none;\n    `,this.searchInput.onfocus=()=>{i.style.transform="scaleX(1)",i.style.transitionDuration="0.15s",i.style.transitionDelay="0s"},this.searchInput.onblur=()=>{i.style.transform="scaleX(0)",i.style.transitionDuration="0.01ms",i.style.transitionDelay="0.01ms"},this.searchInput.oninput=()=>this.handleSearch(),t.appendChild(o),t.appendChild(this.searchInput),t.appendChild(i),e.appendChild(t),e}createTableContainer(){this.tableContainer=u().createElement("div"),this.tableContainer.style.cssText=`\n      flex: 1;\n      overflow: auto;\n      padding: ${n.spacing.m} ${n.spacing.l};\n    `,this.tableContainer.onscroll=()=>this.handleScroll();const e=u().createElement("table");e.style.cssText=`\n      width: 100%;\n      border-collapse: collapse;\n      font-size: ${n.typography.fontSize.body};\n    `;const t=u().createElement("thead"),o=u().createElement("tr");if(this.options.multiSelect){const e=u().createElement("th");e.style.cssText=`\n        padding: ${n.spacing.s};\n        text-align: left;\n        border-bottom: 2px solid ${n.colors.modal.divider};\n        font-weight: ${n.typography.fontWeight.semibold};\n        color: ${n.colors.modal.text};\n        width: 40px;\n      `,o.appendChild(e)}return this.options.columns.forEach(e=>{const t=u().createElement("th");t.style.cssText=`\n        padding: ${n.spacing.s};\n        text-align: left;\n        border-bottom: 2px solid ${n.colors.modal.divider};\n        font-weight: ${n.typography.fontWeight.semibold};\n        color: ${n.colors.modal.text};\n        cursor: pointer;\n        user-select: none;\n      `,t.onclick=()=>this.handleSort(e),t.onmouseover=()=>t.style.background=n.colors.neutralLighter,t.onmouseout=()=>t.style.background="transparent";const i=this.columnLabels.get(e)||e;t.textContent=i,o.appendChild(t)}),t.appendChild(o),e.appendChild(t),this.tableBody=u().createElement("tbody"),e.appendChild(this.tableBody),this.tableContainer.appendChild(e),this.tableContainer}createPagination(){const e=u().createElement("div");return e.style.cssText=`\n      padding: ${n.spacing.m} ${n.spacing.l};\n      border-top: 1px solid ${n.colors.modal.divider};\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      gap: ${n.spacing.m};\n      flex-shrink: 0;\n    `,this.paginationInfo=u().createElement("span"),this.paginationInfo.style.cssText=`\n      color: ${n.colors.modal.textSecondary};\n      font-size: ${n.typography.fontSize.body};\n    `,e.appendChild(this.paginationInfo),e}createFooter(){const e=u().createElement("div");e.style.cssText=`\n      padding: ${n.spacing.l};\n      border-top: 1px solid ${n.colors.modal.divider};\n      display: flex;\n      justify-content: flex-end;\n      gap: ${n.spacing.m};\n      flex-shrink: 0;\n    `;const t=u().createElement("button");if(t.textContent="Cancel",t.style.cssText=`\n      padding: ${n.spacing.s} ${n.spacing.l};\n      background: ${n.colors.modal.secondary};\n      border: 1px solid ${n.colors.modal.secondaryBorder};\n      border-radius: ${n.borderRadius.small};\n      color: ${n.colors.modal.secondaryText};\n      font-size: ${n.typography.fontSize.body};\n      font-weight: ${n.typography.fontWeight.semibold};\n      font-family: ${n.typography.fontFamily};\n      cursor: pointer;\n      transition: all 0.2s;\n    `,t.onmouseover=()=>t.style.background=n.colors.modal.secondaryHover,t.onmouseout=()=>t.style.background=n.colors.modal.secondary,t.onclick=()=>this.cancel(),e.appendChild(t),this.options.multiSelect&&this.options.allowClear){const t=u().createElement("button");t.textContent="Clear Selection",t.style.cssText=`\n        padding: ${n.spacing.s} ${n.spacing.l};\n        background: ${n.colors.modal.secondary};\n        border: 1px solid ${n.colors.modal.secondaryBorder};\n        border-radius: ${n.borderRadius.small};\n        color: ${n.colors.modal.secondaryText};\n        font-size: ${n.typography.fontSize.body};\n        font-weight: ${n.typography.fontWeight.semibold};\n        font-family: ${n.typography.fontFamily};\n        cursor: pointer;\n        transition: all 0.2s;\n      `,t.onmouseover=()=>t.style.background=n.colors.modal.secondaryHover,t.onmouseout=()=>t.style.background=n.colors.modal.secondary,t.onclick=()=>this.clearSelection(),e.appendChild(t)}const o=u().createElement("button");return o.textContent="Select",o.style.cssText=`\n      padding: ${n.spacing.s} ${n.spacing.l};\n      background: ${n.colors.modal.primary};\n      border: none;\n      border-radius: ${n.borderRadius.small};\n      color: ${n.colors.modal.primaryText};\n      font-size: ${n.typography.fontSize.body};\n      font-weight: ${n.typography.fontWeight.semibold};\n      font-family: ${n.typography.fontFamily};\n      cursor: pointer;\n      transition: all 0.2s;\n    `,o.onmouseover=()=>o.style.background=n.colors.modal.primaryHover,o.onmouseout=()=>o.style.background=n.colors.modal.primary,o.onclick=()=>this.select(),e.appendChild(o),e}async loadColumnLabels(){const e=await async function(e){if(m.has(e))return m.get(e);if("undefined"!=typeof window&&window.Xrm?.Utility?.getEntityMetadata)try{const t=await window.Xrm.Utility.getEntityMetadata(e);return m.set(e,t),t}catch(n){console.warn(`Failed to fetch metadata for ${e}:`,n)}const t={EntitySetName:`${e}s`,PrimaryIdAttribute:`${e}id`,PrimaryNameAttribute:"account"===e?"name":"contact"===e?"fullname":"name",DisplayName:{UserLocalizedLabel:{Label:e.charAt(0).toUpperCase()+e.slice(1)}},Attributes:[]};return m.set(e,t),t}(this.options.entity);this.options.columnLabels&&Object.entries(this.options.columnLabels).forEach(([e,t])=>{this.columnLabels.set(e,t)}),this.options.columns.forEach(t=>{if(!this.columnLabels.has(t)){const n=e?.Attributes?.find(e=>e.LogicalName===t),o=n?.DisplayName?.UserLocalizedLabel?.Label||t;this.columnLabels.set(t,o)}})}handleScroll(){if(!this.tableContainer||this.isLoadingMore||!this.hasMoreRecords)return;const{scrollTop:e,scrollHeight:t,clientHeight:n}=this.tableContainer;(e+n)/t>.8&&this.loadMoreRecords()}async loadMoreRecords(){if(!this.isLoadingMore&&this.hasMoreRecords){this.isLoadingMore=!0,this.currentPage++;try{const e=this.sortColumn?[{attribute:this.sortColumn,descending:this.sortDescending}]:this.options.orderBy,t=this.searchInput?.value.trim()||"",n=[...this.options.searchFields,...this.options.additionalSearchFields],o=await f(this.options.entity,this.options.columns,this.options.filters,e,this.currentPage,this.options.pageSize,t,n);0===o.entities.length?this.hasMoreRecords=!1:(this.allLoadedRecords.push(...o.entities),this.records=this.allLoadedRecords,this.renderTableRows())}catch(e){console.error("Failed to load more records:",e)}finally{this.isLoadingMore=!1}}}async loadData(){try{this.currentPage=1,this.allLoadedRecords=[],this.hasMoreRecords=!0;const e=this.sortColumn?[{attribute:this.sortColumn,descending:this.sortDescending}]:this.options.orderBy,t=this.searchInput?.value.trim()||"",n=[...this.options.searchFields,...this.options.additionalSearchFields],o=await f(this.options.entity,this.options.columns,this.options.filters,e,this.currentPage,this.options.pageSize,t,n);this.allLoadedRecords=o.entities,this.records=this.allLoadedRecords,this.totalRecords=o.totalCount,this.renderTableRows(),this.updatePagination()}catch(e){console.error("Failed to load lookup data:",e)}}renderTableRows(){if(!this.tableBody)return;this.tableBody.innerHTML="";const e=m.get(this.options.entity),t=e?.PrimaryIdAttribute||`${this.options.entity}id`;if(this.records.forEach((e,o)=>{const i=u().createElement("tr");i.style.cssText="\n        cursor: pointer;\n        transition: background 0.2s;\n      ";const s=e[t],r=this.selectedRecords.has(s);if(r&&(i.style.background=n.colors.neutralLighter),i.onmouseover=()=>{r||(i.style.background=n.colors.neutralLighterAlt)},i.onmouseout=()=>{r||(i.style.background=o%2==0?"white":n.colors.neutralLighterAlt)},i.onclick=e=>{"INPUT"!==e.target.tagName&&this.toggleSelection(s)},this.options.multiSelect){const e=u().createElement("td");e.style.cssText=`\n          padding: ${n.spacing.s};\n          border-bottom: 1px solid ${n.colors.modal.divider};\n        `;const t=u().createElement("input");t.type="checkbox",t.checked=r,t.onchange=()=>this.toggleSelection(s),e.appendChild(t),i.appendChild(e)}this.options.columns.forEach(t=>{const o=u().createElement("td");o.style.cssText=`\n          padding: ${n.spacing.s};\n          border-bottom: 1px solid ${n.colors.modal.divider};\n          color: ${n.colors.modal.text};\n        `;const s=e[t];o.textContent=function(e){if(null==e)return"";if(e instanceof Date||/^\d{4}-\d{2}-\d{2}T/.test(e))try{const t=new Date(e);return t.toLocaleDateString()+" "+t.toLocaleTimeString()}catch{return String(e)}return"number"==typeof e?e.toLocaleString():"object"==typeof e&&void 0!==e._value?e._value||"":String(e)}(s),i.appendChild(o)}),this.tableBody.appendChild(i)}),0===this.records.length){const e=u().createElement("tr"),t=u().createElement("td");t.colSpan=this.options.columns.length+(this.options.multiSelect?1:0),t.style.cssText=`\n        padding: ${n.spacing.xl};\n        text-align: center;\n        color: ${n.colors.modal.textSecondary};\n      `,t.textContent="No records found",e.appendChild(t),this.tableBody.appendChild(e)}}toggleSelection(e){this.options.multiSelect?this.selectedRecords.has(e)?this.selectedRecords.delete(e):this.selectedRecords.add(e):(this.selectedRecords.clear(),this.selectedRecords.add(e)),this.renderTableRows()}clearSelection(){this.selectedRecords.clear(),this.options.onSelect([]),this.close()}handleSearch(){clearTimeout(this.searchDebounceTimer),this.searchDebounceTimer=window.setTimeout(()=>{this.currentPage=1,this.loadData()},300)}handleSort(e){this.sortColumn===e?this.sortDescending=!this.sortDescending:(this.sortColumn=e,this.sortDescending=!1),this.loadData()}updatePagination(){if(this.options.showPagination&&this.paginationInfo){const e=this.allLoadedRecords.length;this.hasMoreRecords?this.paginationInfo.textContent=`Showing ${e} of ${this.totalRecords} records (scroll for more)`:this.paginationInfo.textContent=`Showing all ${e} records`}}select(){const e=m.get(this.options.entity),t=e?.PrimaryIdAttribute||`${this.options.entity}id`,n=e?.PrimaryNameAttribute||"name",o=Array.from(this.selectedRecords).map(e=>{const o=this.records.find(n=>n[t]===e);return o?{id:o[t],name:o[n]||o.name||"",entityType:this.options.entity,attributes:o}:null}).filter(e=>null!==e);this.options.onSelect(o),this.close()}cancel(){this.options.onCancel(),this.close()}close(){this.modal.style.animation="fadeOutScale 0.2s ease-in",this.overlay.style.animation="fadeOut 0.2s ease-in",setTimeout(()=>{this.container.parentElement&&this.container.parentElement.removeChild(this.container),this.overlay.parentElement&&this.overlay.parentElement.removeChild(this.overlay),t.activeInstance=null},200)}show(){const e=u();e.body.appendChild(this.overlay),e.body.appendChild(this.container)}static open(e){t.activeInstance&&t.activeInstance.close();const n=new t(e);t.activeInstance=n,n.show()}}).activeInstance=null,t);const y=["%c BUG ","background: #9C27B0; color: white; font-weight: bold; padding: 2px 6px; border-radius: 3px;"],b=["%c WAR ","background: #FF9800; color: white; font-weight: bold; padding: 2px 6px; border-radius: 3px;"],x=["%c ERR ","background: #F44336; color: white; font-weight: bold; padding: 2px 6px; border-radius: 3px;"],w={BUG:y,WAR:b,ERR:x};class v{constructor(e){this.id=e.id,this.label=e.label,this.type=e.type||"text",this.value=e.value,this.placeholder=e.placeholder,this.disabled=e.disabled,this.required=e.required,this.divider=e.divider,this.extraAttributes=e.extraAttributes,this.showValue=e.showValue,this.validation=e.validation}}class ${constructor(e){this.type="textarea",this.id=e.id,this.label=e.label,this.value=e.value,this.placeholder=e.placeholder,this.disabled=e.disabled,this.required=e.required,this.rows=e.rows||4,this.divider=e.divider}}class C{constructor(e){this.type="select",this.id=e.id,this.label=e.label,this.value=e.value,this.disabled=e.disabled,this.required=e.required,this.options=e.options||[],this.multiSelect=e.multiSelect||!1,this.divider=e.divider}}class S{constructor(e){this.type="daterange",this.id=e.id,this.label=e.label,this.startDate=e.startDate,this.endDate=e.endDate,this.required=e.required,this.disabled=e.disabled,this.divider=e.divider}}class T{constructor(e){this.type="lookup",this.id=e.id,this.label=e.label,this.entityTypes=e.entityTypes||[],this.allowMultiSelect=e.allowMultiSelect||!1,this.callback=e.callback,this.required=e.required,this.disabled=e.disabled,this.divider=e.divider}}class E{constructor(e){this.type="custom",this.id=e.id,this.label=e.label,this.render=e.render,this.html=e.html,this.divider=e.divider}}class k{constructor(e){this.type="group",this.id=e.id,this.label=e.label,this.fields=e.fields||[],this.asTabs=e.asTabs||!1,this.divider=e.divider}}function L(e){console.log("err403 UI Library initialized",{executionContext:e})}function z(e){L(e)}if("undefined"!=typeof window){const e={init:L,onLoad:z,Toast:a,Modal:c,ModalButton:l,ModalHelpers:p,Lookup:g,Logger:w,BUG:y,WAR:b,ERR:x,theme:n,Input:v,MultiLine:$,OptionSet:C,DateRange:S,LookupField:T,Custom:E,Group:k,Button:l};window.err403=e;try{window.parent&&window.parent!==window&&(window.parent.err403=e),window.top&&window.top!==window&&(window.top.err403=e)}catch(R){console.warn("err403: Running in cross-origin iframe, library only available in current frame")}}e.BUG=y,e.Button=l,e.Custom=E,e.DateRange=S,e.ERR=x,e.Group=k,e.Input=v,e.Logger=w,e.Lookup=g,e.LookupField=T,e.Modal=c,e.ModalButton=l,e.ModalHelpers=p,e.MultiLine=$,e.OptionSet=C,e.Toast=a,e.WAR=b,e.init=L,e.onLoad=z,e.theme=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});
//# sourceMappingURL=ui-lib.min.js.map
