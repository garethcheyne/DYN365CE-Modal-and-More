{"version":3,"file":"ui-lib.min.js","sources":["../src/styles/theme.ts","../src/styles/animations.ts","../src/components/Toast/Toast.ts","../src/components/Modal/Modal.types.ts","../src/components/Modal/Modal.ts","../src/components/Modal/ModalHelpers.ts","../src/utils/dom.ts","../src/components/Lookup/Lookup.ts","../src/components/Logger/Logger.ts","../src/components/Modal/ModalFields.ts","../src/index.ts"],"sourcesContent":["/**\r\n * Fluent UI-inspired design tokens\r\n * Custom theme for D365 CE UI Library\r\n */\r\n\r\nexport const theme = {\r\n  colors: {\r\n    // Primary colors\r\n    primary: '#0078d4',\r\n    primaryHover: '#106ebe',\r\n    primaryPressed: '#005a9e',\r\n    \r\n    // Semantic colors\r\n    success: '#107c10',\r\n    error: '#a80000',\r\n    warning: '#f3f2f1',\r\n    info: '#0078d4',\r\n    \r\n    // Neutral palette\r\n    neutralPrimary: '#323130',\r\n    neutralSecondary: '#605e5c',\r\n    neutralTertiary: '#a19f9d',\r\n    neutralLight: '#edebe9',\r\n    neutralLighter: '#f3f2f1',\r\n    neutralLighterAlt: '#faf9f8',\r\n    white: '#ffffff',\r\n    \r\n    // Toast-specific colors\r\n    toast: {\r\n      success: {\r\n        bg: 'rgba(16, 124, 16, 0.9)',\r\n        border: '#107c10',\r\n        text: '#ffffff'\r\n      },\r\n      error: {\r\n        bg: 'rgba(168, 0, 0, 0.9)',\r\n        border: '#a80000',\r\n        text: '#ffffff'\r\n      },\r\n      warn: {\r\n        bg: 'rgba(255, 185, 0, 0.9)',\r\n        border: '#ffb900',\r\n        text: '#323130'\r\n      },\r\n      info: {\r\n        bg: 'rgba(0, 120, 212, 0.9)',\r\n        border: '#0078d4',\r\n        text: '#ffffff'\r\n      },\r\n      default: {\r\n        bg: 'rgba(50, 49, 48, 0.95)',\r\n        border: '#323130',\r\n        text: '#ffffff'\r\n      }\r\n    },\r\n    \r\n    // Modal-specific colors\r\n    modal: {\r\n      background: '#ffffff',\r\n      text: '#323130',\r\n      textSecondary: '#605e5c',\r\n      border: '#edebe9',\r\n      overlay: 'rgba(0, 0, 0, 0.4)',\r\n      headerBackground: '#ffffff',\r\n      footerBackground: '#ffffff',\r\n      divider: '#edebe9',\r\n      \r\n      // Button colors\r\n      primary: '#0078d4',\r\n      primaryHover: '#106ebe',\r\n      primaryPressed: '#005a9e',\r\n      primaryText: '#ffffff',\r\n      \r\n      secondary: 'transparent',\r\n      secondaryBorder: '#8a8886',\r\n      secondaryText: '#323130',\r\n      secondaryHover: '#f3f2f1',\r\n      secondaryPressed: '#edebe9',\r\n      \r\n      danger: '#a80000',\r\n      dangerHover: '#750b0b',\r\n      dangerPressed: '#5a0000',\r\n      dangerText: '#ffffff',\r\n      \r\n      // Input colors (D365 style - gray background)\r\n      inputBackground: '#faf9f8',\r\n      inputBorder: 'transparent',\r\n      inputBorderBottom: '#8a8886',\r\n      inputBorderHover: '#323130',\r\n      inputBorderFocus: '#0078d4',\r\n      inputText: '#323130',\r\n      inputPlaceholder: '#605e5c',\r\n      inputDisabled: '#f0f0f0',\r\n      \r\n      // Tab colors\r\n      tabBorder: '#edebe9',\r\n      tabActive: '#0078d4',\r\n      tabActiveBorder: '#0078d4',\r\n      tabInactive: '#323130',\r\n      tabInactiveBorder: 'transparent',\r\n      tabHover: '#106ebe',\r\n      tabBackground: '#ffffff',\r\n      tabSelectedBackground: '#ffffff',\r\n      \r\n      // Progress colors\r\n      progress: {\r\n        bar: '#0078d4',\r\n        barBackground: '#edebe9',\r\n        stepActive: '#0078d4',\r\n        stepCompleted: '#107c10',\r\n        stepPending: '#d2d0ce',\r\n        stepText: '#323130',\r\n        stepBorder: '#8a8886'\r\n      },\r\n      \r\n      // Side cart colors\r\n      sideCart: {\r\n        background: '#faf9f8',\r\n        border: '#edebe9',\r\n        text: '#323130'\r\n      }\r\n    }\r\n  },\r\n  \r\n  shadows: {\r\n    toast: '0 0 2px rgba(0, 0, 0, 0.12), 0 2px 4px rgba(0, 0, 0, 0.14)',\r\n    modal: '0 0 2px rgba(0, 0, 0, 0.12), 0 2px 4px rgba(0, 0, 0, 0.14)',\r\n    dropdown: '0 0 2px rgba(0, 0, 0, 0.12), 0 2px 4px rgba(0, 0, 0, 0.14)',\r\n    card: '0 0 2px rgba(0, 0, 0, 0.12), 0 2px 4px rgba(0, 0, 0, 0.14)',\r\n    depth8: '0 0 2px rgba(0, 0, 0, 0.12), 0 2px 4px rgba(0, 0, 0, 0.14)',\r\n    depth16: '0 0 2px rgba(0, 0, 0, 0.12), 0 2px 4px rgba(0, 0, 0, 0.14)',\r\n    depth64: '0 0 2px rgba(0, 0, 0, 0.12), 0 2px 4px rgba(0, 0, 0, 0.14)'\r\n  },\r\n  \r\n  borderRadius: {\r\n    none: '0px',\r\n    small: '4px',      // D365 input fields use 4px radius (borderRadiusMedium)\r\n    medium: '8px',     // D365 modals/toasts use 8px radius\r\n    large: '8px',      // D365 larger elements\r\n    circular: '50%'\r\n  },\r\n  \r\n  typography: {\r\n    fontFamily: \"'Segoe UI', -apple-system, BlinkMacSystemFont, 'Roboto', 'Helvetica Neue', sans-serif\",\r\n    fontSize: {\r\n      caption: '12px',\r\n      body: '14px',\r\n      subtitle: '16px',\r\n      title: '18px',\r\n      large: '20px',\r\n      xLarge: '24px'\r\n    },\r\n    fontWeight: {\r\n      regular: 400,\r\n      semibold: 600,\r\n      bold: 700\r\n    },\r\n    lineHeight: {\r\n      caption: '16px',\r\n      body: '20px',\r\n      subtitle: '22px',\r\n      title: '24px'\r\n    }\r\n  },\r\n  \r\n  spacing: {\r\n    none: '0px',\r\n    xxs: '2px',\r\n    xs: '4px',\r\n    sNudge: '6px',\r\n    s: '8px',\r\n    mNudge: '10px',\r\n    m: '12px',\r\n    l: '16px',\r\n    xl: '20px',\r\n    xxl: '24px',\r\n    xxxl: '32px'\r\n  },\r\n  \r\n  zIndex: {\r\n    toast: 999999,\r\n    modal: 999998,\r\n    modalOverlay: 999997,\r\n    dropdown: 1000\r\n  }\r\n};\r\n","/**\r\n * CSS animations for the UI library\r\n */\r\n\r\nexport const animations = {\r\n  slideInRight: `\r\n    @keyframes slideInRight {\r\n      from {\r\n        transform: translateX(100%);\r\n        opacity: 0;\r\n      }\r\n      to {\r\n        transform: translateX(0);\r\n        opacity: 1;\r\n      }\r\n    }\r\n  `,\r\n  slideOutRight: `\r\n    @keyframes slideOutRight {\r\n      from {\r\n        transform: translateX(0);\r\n        opacity: 1;\r\n      }\r\n      to {\r\n        transform: translateX(100%);\r\n        opacity: 0;\r\n      }\r\n    }\r\n  `,\r\n  fadeInScale: `\r\n    @keyframes fadeInScale {\r\n      from {\r\n        opacity: 0;\r\n        transform: translate(-50%, -50%) scale(0.9);\r\n      }\r\n      to {\r\n        opacity: 1;\r\n        transform: translate(-50%, -50%) scale(1);\r\n      }\r\n    }\r\n  `,\r\n  fadeOutScale: `\r\n    @keyframes fadeOutScale {\r\n      from {\r\n        opacity: 1;\r\n        transform: translate(-50%, -50%) scale(1);\r\n      }\r\n      to {\r\n        opacity: 0;\r\n        transform: translate(-50%, -50%) scale(0.9);\r\n      }\r\n    }\r\n  `,\r\n  fadeIn: `\r\n    @keyframes fadeIn {\r\n      from {\r\n        opacity: 0;\r\n      }\r\n      to {\r\n        opacity: 1;\r\n      }\r\n    }\r\n  `,\r\n  fadeOut: `\r\n    @keyframes fadeOut {\r\n      from {\r\n        opacity: 1;\r\n      }\r\n      to {\r\n        opacity: 0;\r\n      }\r\n    }\r\n  `,\r\n  spin: `\r\n    @keyframes spin {\r\n      from {\r\n        transform: rotate(0deg);\r\n      }\r\n      to {\r\n        transform: rotate(360deg);\r\n      }\r\n    }\r\n  `,\r\n  progressFill: `\r\n    @keyframes progressFill {\r\n      from {\r\n        width: 0%;\r\n      }\r\n    }\r\n  `\r\n};\r\n\r\n/**\r\n * Inject animations into the document head\r\n */\r\nexport function injectAnimations(): void {\r\n  const styleId = 'err403-animations';\r\n  \r\n  // Check if already injected\r\n  if (document.getElementById(styleId)) {\r\n    return;\r\n  }\r\n  \r\n  const style = document.createElement('style');\r\n  style.id = styleId;\r\n  style.textContent = Object.values(animations).join('\\n');\r\n  document.head.appendChild(style);\r\n}\r\n","/**\r\n * Toast Notification System\r\n * Provides toast notifications with different types and sound support\r\n */\r\n\r\nimport { theme } from '../../styles/theme';\r\nimport { injectAnimations } from '../../styles/animations';\r\nimport type { ToastOptions, ToastInstance, ToastType } from './Toast.types';\r\n\r\n/**\r\n * Create toast container if it doesn't exist\r\n */\r\nconst getToastContainer = (() => {\r\n  let container: HTMLElement | null = null;\r\n  \r\n  return (): HTMLElement => {\r\n    if (container) return container;\r\n    \r\n    const existing = document.getElementById('err403-toast-container');\r\n    if (existing) {\r\n      container = existing;\r\n      return container;\r\n    }\r\n    \r\n    container = document.createElement('div');\r\n    container.id = 'err403-toast-container';\r\n    container.style.cssText = `\r\n    position: fixed;\r\n    top: 20px;\r\n    right: 20px;\r\n    z-index: ${theme.zIndex.toast};\r\n    pointer-events: none;\r\n  `;\r\n    \r\n    // Inject animations\r\n    injectAnimations();\r\n    \r\n    // Support D365 iframes\r\n    const targetDocument = (window.parent?.document || document);\r\n    targetDocument.body.appendChild(container);\r\n    \r\n    return container;\r\n  };\r\n})();\r\n\r\n/**\r\n * Get icon SVG for toast type\r\n */\r\nfunction getToastIcon(type: ToastType): string {\r\n  const icons = {\r\n    success: '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\"><path d=\"M10 0C4.48 0 0 4.48 0 10s4.48 10 10 10 10-4.48 10-10S15.52 0 10 0zm-2 15l-5-5 1.41-1.41L8 12.17l7.59-7.59L17 6l-9 9z\" fill=\"currentColor\"/></svg>',\r\n    error: '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\"><path d=\"M10 0C4.48 0 0 4.48 0 10s4.48 10 10 10 10-4.48 10-10S15.52 0 10 0zm1 15H9v-2h2v2zm0-4H9V5h2v6z\" fill=\"currentColor\"/></svg>',\r\n    warn: '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\"><path d=\"M1 17h18L10 1 1 17zm10-2H9v-2h2v2zm0-4H9V7h2v4z\" fill=\"currentColor\"/></svg>',\r\n    info: '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\"><path d=\"M10 0C4.48 0 0 4.48 0 10s4.48 10 10 10 10-4.48 10-10S15.52 0 10 0zm1 15H9V9h2v6zm0-8H9V5h2v2z\" fill=\"currentColor\"/></svg>',\r\n    default: '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\"><circle cx=\"10\" cy=\"10\" r=\"9\" stroke=\"currentColor\" stroke-width=\"2\" fill=\"none\"/><circle cx=\"10\" cy=\"10\" r=\"3\" fill=\"currentColor\"/></svg>'\r\n  };\r\n  \r\n  return icons[type];\r\n}\r\n\r\n/**\r\n * Play notification sound\r\n */\r\nfunction playNotificationSound(type: ToastType): void {\r\n  // Only play sound for success and error\r\n  if (type !== 'success' && type !== 'error') return;\r\n  \r\n  try {\r\n    const audioContext = new (window.AudioContext || (window as any).webkitAudioContext)();\r\n    const oscillator = audioContext.createOscillator();\r\n    const gainNode = audioContext.createGain();\r\n    \r\n    oscillator.connect(gainNode);\r\n    gainNode.connect(audioContext.destination);\r\n    \r\n    // Different frequencies for success vs error\r\n    oscillator.frequency.value = type === 'success' ? 800 : 400;\r\n    oscillator.type = 'sine';\r\n    \r\n    // Quick beep\r\n    gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);\r\n    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);\r\n    \r\n    oscillator.start(audioContext.currentTime);\r\n    oscillator.stop(audioContext.currentTime + 0.1);\r\n  } catch (e) {\r\n    // Audio not supported or blocked\r\n  }\r\n}\r\n\r\n/**\r\n * Create a toast notification\r\n */\r\nfunction createToast(options: ToastOptions, type: ToastType): ToastInstance {\r\n  const { title, message = '', duration = 6000, sound = false } = options;\r\n  const colors = theme.colors.toast[type];\r\n  \r\n  // Create toast element\r\n  const toast = document.createElement('div');\r\n  toast.className = 'err403-toast';\r\n  toast.style.cssText = `\r\n    display: flex;\r\n    align-items: flex-start;\r\n    gap: 12px;\r\n    min-width: 300px;\r\n    max-width: 500px;\r\n    padding: 16px;\r\n    margin-bottom: 12px;\r\n    background: ${colors.bg};\r\n    border-left: 4px solid ${colors.border};\r\n    border-radius: ${theme.borderRadius.medium};\r\n    box-shadow: ${theme.shadows.toast};\r\n    color: ${colors.text};\r\n    font-family: ${theme.typography.fontFamily};\r\n    font-size: ${theme.typography.fontSize.body};\r\n    pointer-events: all;\r\n    cursor: pointer;\r\n    animation: slideInRight 0.3s ease-out;\r\n    backdrop-filter: blur(10px);\r\n    transition: transform 0.2s ease, opacity 0.2s ease;\r\n  `;\r\n  \r\n  // Icon\r\n  const iconDiv = document.createElement('div');\r\n  iconDiv.style.cssText = `\r\n    flex-shrink: 0;\r\n    margin-top: 2px;\r\n  `;\r\n  iconDiv.innerHTML = getToastIcon(type);\r\n  \r\n  // Content\r\n  const content = document.createElement('div');\r\n  content.style.cssText = `\r\n    flex: 1;\r\n    overflow: hidden;\r\n  `;\r\n  \r\n  // Title\r\n  const titleDiv = document.createElement('div');\r\n  titleDiv.textContent = title;\r\n  titleDiv.style.cssText = `\r\n    font-weight: ${theme.typography.fontWeight.semibold};\r\n    margin-bottom: ${message ? '4px' : '0'};\r\n  `;\r\n  content.appendChild(titleDiv);\r\n  \r\n  // Message\r\n  if (message) {\r\n    const messageDiv = document.createElement('div');\r\n    messageDiv.textContent = message;\r\n    messageDiv.style.cssText = `\r\n      font-size: ${theme.typography.fontSize.caption};\r\n      opacity: 0.95;\r\n      word-wrap: break-word;\r\n    `;\r\n    content.appendChild(messageDiv);\r\n  }\r\n  \r\n  // Close button\r\n  const closeBtn = document.createElement('button');\r\n  closeBtn.innerHTML = '×';\r\n  closeBtn.style.cssText = `\r\n    flex-shrink: 0;\r\n    background: none;\r\n    border: none;\r\n    color: ${colors.text};\r\n    font-size: 24px;\r\n    line-height: 1;\r\n    cursor: pointer;\r\n    padding: 0;\r\n    width: 20px;\r\n    height: 20px;\r\n    opacity: 0.7;\r\n    transition: opacity 0.2s;\r\n  `;\r\n  closeBtn.onmouseover = () => closeBtn.style.opacity = '1';\r\n  closeBtn.onmouseout = () => closeBtn.style.opacity = '0.7';\r\n  \r\n  // Append elements\r\n  toast.appendChild(iconDiv);\r\n  toast.appendChild(content);\r\n  toast.appendChild(closeBtn);\r\n  \r\n  // Hover effect\r\n  toast.onmouseover = () => {\r\n    toast.style.transform = 'translateX(-4px)';\r\n  };\r\n  toast.onmouseout = () => {\r\n    toast.style.transform = 'translateX(0)';\r\n  };\r\n  \r\n  // Toast instance\r\n  const instance: ToastInstance = {\r\n    element: toast,\r\n    show() {\r\n      const container = getToastContainer();\r\n      container.appendChild(toast);\r\n      \r\n      // Play sound if requested\r\n      if (sound) {\r\n        playNotificationSound(type);\r\n      }\r\n      \r\n      // Auto-dismiss\r\n      if (duration > 0) {\r\n        setTimeout(() => {\r\n          this.close();\r\n        }, duration);\r\n      }\r\n    },\r\n    close() {\r\n      toast.style.animation = 'slideOutRight 0.3s ease-in';\r\n      setTimeout(() => {\r\n        if (toast.parentElement) {\r\n          toast.parentElement.removeChild(toast);\r\n        }\r\n      }, 300);\r\n    }\r\n  };\r\n  \r\n  // Click to dismiss (except close button)\r\n  toast.onclick = (e) => {\r\n    if (e.target !== closeBtn) {\r\n      instance.close();\r\n    }\r\n  };\r\n  \r\n  // Close button handler\r\n  closeBtn.onclick = (e) => {\r\n    e.stopPropagation();\r\n    instance.close();\r\n  };\r\n  \r\n  return instance;\r\n}\r\n\r\n/**\r\n * Toast API\r\n */\r\nexport const Toast = {\r\n  success(\r\n    titleOrOptions: string | ToastOptions,\r\n    message?: string,\r\n    duration?: number,\r\n    sound?: boolean\r\n  ): ToastInstance {\r\n    const options: ToastOptions = typeof titleOrOptions === 'string'\r\n      ? { title: titleOrOptions, message, duration, sound }\r\n      : { ...titleOrOptions };\r\n    \r\n    const toast = createToast(options, 'success');\r\n    toast.show();\r\n    return toast;\r\n  },\r\n  \r\n  error(\r\n    titleOrOptions: string | ToastOptions,\r\n    message?: string,\r\n    duration?: number,\r\n    sound?: boolean\r\n  ): ToastInstance {\r\n    const options: ToastOptions = typeof titleOrOptions === 'string'\r\n      ? { title: titleOrOptions, message, duration, sound }\r\n      : { ...titleOrOptions };\r\n    \r\n    const toast = createToast(options, 'error');\r\n    toast.show();\r\n    return toast;\r\n  },\r\n  \r\n  warn(\r\n    titleOrOptions: string | ToastOptions,\r\n    message?: string,\r\n    duration?: number,\r\n    sound?: boolean\r\n  ): ToastInstance {\r\n    const options: ToastOptions = typeof titleOrOptions === 'string'\r\n      ? { title: titleOrOptions, message, duration, sound }\r\n      : { ...titleOrOptions };\r\n    \r\n    const toast = createToast(options, 'warn');\r\n    toast.show();\r\n    return toast;\r\n  },\r\n  \r\n  info(\r\n    titleOrOptions: string | ToastOptions,\r\n    message?: string,\r\n    duration?: number,\r\n    sound?: boolean\r\n  ): ToastInstance {\r\n    const options: ToastOptions = typeof titleOrOptions === 'string'\r\n      ? { title: titleOrOptions, message, duration, sound }\r\n      : { ...titleOrOptions };\r\n    \r\n    const toast = createToast(options, 'info');\r\n    toast.show();\r\n    return toast;\r\n  },\r\n  \r\n  default(\r\n    titleOrOptions: string | ToastOptions,\r\n    message?: string,\r\n    duration?: number,\r\n    sound?: boolean\r\n  ): ToastInstance {\r\n    const options: ToastOptions = typeof titleOrOptions === 'string'\r\n      ? { title: titleOrOptions, message, duration, sound }\r\n      : { ...titleOrOptions };\r\n    \r\n    const toast = createToast(options, 'default');\r\n    toast.show();\r\n    return toast;\r\n  }\r\n};\r\n","/**\r\n * Modal component type definitions\r\n */\r\n\r\nexport type ModalSize = 'small' | 'medium' | 'large' | 'fullscreen' | 'custom';\r\nexport type ModalIcon = 'INFO' | 'SUCCESS' | 'WARNING' | 'ERROR' | 'QUESTION';\r\nexport type ButtonAlignment = 'left' | 'center' | 'right' | 'space-between';\r\n\r\nexport interface ModalOptions {\r\n    id?: string;\r\n    title: string;\r\n    message?: string;\r\n    content?: string;\r\n    customContent?: HTMLElement;\r\n    icon?: ModalIcon;\r\n    size?: ModalSize;\r\n    width?: number;\r\n    height?: number;\r\n    padding?: number;\r\n    preventClose?: boolean;\r\n    allowDismiss?: boolean;\r\n    allowEscapeClose?: boolean;\r\n    draggable?: boolean;\r\n    buttonAlignment?: ButtonAlignment;\r\n    autoSave?: boolean;\r\n    autoSaveKey?: string;\r\n    progress?: ProgressConfig;\r\n    sideCart?: SideCartConfig;\r\n    fields?: FieldConfig[];\r\n    buttons?: ModalButton[];\r\n}\r\n\r\nexport interface ProgressConfig {\r\n    enabled: boolean;\r\n    type?: 'bar' | 'steps-left' | 'steps-right' | 'step';\r\n    currentStep?: number;\r\n    totalSteps?: number;\r\n    steps?: StepConfig[];\r\n    allowStepNavigation?: boolean;\r\n}\r\n\r\nexport interface StepConfig {\r\n    id?: string;\r\n    label?: string;\r\n    name?: string;\r\n    description?: string;\r\n    completed?: boolean;\r\n    fields?: FieldConfig[];\r\n    validate?: () => boolean;\r\n}\r\n\r\nexport interface SideCartConfig {\r\n    enabled: boolean;\r\n    attached?: boolean;\r\n    position?: 'left' | 'right';\r\n    width?: number;\r\n    content?: string;\r\n    imageUrl?: string;\r\n    backgroundColor?: string;\r\n}\r\n\r\nexport interface FieldConfig {\r\n    id: string;\r\n    label?: string;\r\n    labelPosition?: 'left' | 'top';\r\n    type?: string;\r\n    value?: any;\r\n    placeholder?: string;\r\n    disabled?: boolean;\r\n    required?: boolean;\r\n    rows?: number;\r\n    options?: Array<string | { label: string; value: string }>;\r\n    multiSelect?: boolean;\r\n    startDate?: Date;\r\n    endDate?: Date;\r\n    entityTypes?: string[];\r\n    allowMultiSelect?: boolean;\r\n    callback?: (selected: any[]) => void;\r\n    render?: () => HTMLElement;\r\n    html?: string;\r\n    fields?: FieldConfig[];\r\n    asTabs?: boolean;\r\n    divider?: boolean;\r\n    extraAttributes?: Record<string, string | number>;\r\n    showValue?: boolean;\r\n    validation?: ValidationConfig;\r\n}\r\n\r\nexport interface ValidationConfig {\r\n    rules?: ValidationRule[];\r\n    showErrors?: boolean;\r\n}\r\n\r\nexport interface ValidationRule {\r\n    type: 'required' | 'email' | 'minLength' | 'maxLength' | 'pattern' | 'custom';\r\n    value?: any;\r\n    message: string;\r\n    validate?: (value: any) => boolean;\r\n}\r\n\r\nexport class ModalButton {\r\n    label: string;\r\n    callback: () => void | false | Promise<void | false>;\r\n    setFocus: boolean;\r\n    preventClose: boolean;\r\n    isDestructive: boolean;\r\n\r\n    constructor(\r\n        label: string,\r\n        callback: () => void | false | Promise<void | false>,\r\n        setFocus: boolean = false,\r\n        preventClose: boolean = false,\r\n        isDestructive: boolean = false\r\n    ) {\r\n        this.label = label;\r\n        this.callback = callback;\r\n        this.setFocus = setFocus;\r\n        this.preventClose = preventClose;\r\n        this.isDestructive = isDestructive;\r\n    }\r\n}\r\n\r\nexport interface ModalResponse {\r\n    button: ModalButton;\r\n    data: Record<string, any>;\r\n}\r\n\r\nexport interface ModalInstance {\r\n    show(): void;\r\n    showAsync(): Promise<ModalResponse>;\r\n    close(): void;\r\n    setLoading(loading: boolean, message?: string): void;\r\n    updateProgress(step: number, skipValidation?: boolean): void;\r\n    nextStep(): void;\r\n    previousStep(): void;\r\n    goToStep(stepId: string): void;\r\n    getFieldValue(fieldId: string): any;\r\n    getFieldValues(): Record<string, any>;\r\n    validateCurrentStep(): boolean;\r\n    validateAllFields(): boolean;\r\n    updateSideCart(content: string | { imageUrl: string }): void;\r\n    clearAutoSave(): void;\r\n    getElement(selector?: string): HTMLElement | HTMLElement[] | null;\r\n    title(title: string): this;\r\n    message(message: string): this;\r\n    content(content: string): this;\r\n    width(width: number): this;\r\n    height(height: number): this;\r\n    showWebResource(webResourcePath: string): void;\r\n}\r\n","/**\n * Modal Component\n * Advanced dialog system for D365 CE\n */\n\nimport { theme } from '../../styles/theme';\nimport { injectAnimations } from '../../styles/animations';\nimport type {\n  ModalOptions,\n  ModalInstance,\n  ModalResponse,\n  FieldConfig\n} from './Modal.types';\nimport { ModalButton } from './Modal.types';\n\n/**\n * Get target document for D365 iframe support\n */\nfunction getTargetDocument(): Document {\n  try {\n    if (window.self !== window.top && window.top) {\n      return window.top.document;\n    }\n  } catch (e) {\n    // Cross-origin - use current document\n  }\n  return document;\n}\n\n/**\n * Modal class\n */\nexport class Modal implements ModalInstance {\n  private overlay: HTMLElement | null = null;\n  private container: HTMLElement | null = null;\n  private modal: HTMLElement | null = null;\n  private header: HTMLElement | null = null;\n  private body: HTMLElement | null = null;\n  private footer: HTMLElement | null = null;\n  private loadingOverlay: HTMLElement | null = null;\n  private resolvePromise: ((value: ModalResponse) => void) | null = null;\n  private fieldValues: Map<string, any> = new Map();\n  private currentStep: number = 1;\n  private options: ModalOptions;\n  private isDragging: boolean = false;\n  private dragStartX: number = 0;\n  private dragStartY: number = 0;\n  private modalStartX: number = 0;\n  private modalStartY: number = 0;\n\n  constructor(options: ModalOptions) {\n    this.options = {\n      preventClose: false,\n      allowDismiss: true,\n      allowEscapeClose: true,\n      draggable: false,\n      buttonAlignment: 'right',\n      autoSave: false,\n      size: 'medium',\n      ...options\n    };\n\n    this.createModal();\n  }\n\n  private createModal(): void {\n    const doc = getTargetDocument();\n    injectAnimations();\n\n    this.overlay = doc.createElement('div');\n    this.overlay.style.cssText = `\n      position: fixed;\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: 100%;\n      background: ${theme.colors.modal.overlay};\n      z-index: ${theme.zIndex.modalOverlay};\n      animation: fadeIn 0.2s ease-out;\n    `;\n\n    if (this.options.allowDismiss) {\n      this.overlay.onclick = () => this.close();\n    }\n\n    this.container = doc.createElement('div');\n    this.container.style.cssText = `\n      position: fixed;\n      top: 50%;\n      left: 50%;\n      transform: translate(-50%, -50%);\n      z-index: ${theme.zIndex.modal};\n      animation: fadeInScale 0.3s ease-out;\n    `;\n    this.container.onclick = (e) => e.stopPropagation();\n\n    this.modal = doc.createElement('div');\n    const { width, height } = this.getModalDimensions();\n\n    this.modal.style.cssText = `\n      background: #fafafa;\n      border-radius: ${theme.borderRadius.medium};\n      box-shadow: ${theme.shadows.modal};\n      width: ${width}px;\n      max-width: 95vw;\n      ${height ? `height: ${height}px; max-height: 90vh;` : 'max-height: 90vh;'}\n      display: flex;\n      flex-direction: column;\n      overflow: hidden;\n    `;\n\n    this.createHeader();\n    this.createBody();\n    this.modal.appendChild(this.body!);\n    this.createFooter();\n\n    // If sideCart is enabled, create a wrapper for modal + sideCart\n    if (this.options.sideCart?.enabled) {\n      const isAttached = this.options.sideCart.attached === true;\n      const modalWrapper = doc.createElement('div');\n      modalWrapper.style.cssText = `\n        display: flex;\n        ${this.options.sideCart.position === 'left' ? 'flex-direction: row-reverse;' : 'flex-direction: row;'}\n        align-items: stretch;\n        ${!isAttached ? 'gap: 18px;' : ''}\n      `;\n      \n      const sideCart = this.createSideCart();\n      \n      modalWrapper.appendChild(this.modal);\n      if (sideCart) {\n        modalWrapper.appendChild(sideCart);\n      }\n      \n      this.container.appendChild(modalWrapper);\n    } else {\n      this.container.appendChild(this.modal);\n    }\n\n    if (this.options.allowEscapeClose) {\n      doc.addEventListener('keydown', this.handleEscapeKey);\n    }\n  }\n\n  private getModalDimensions(): { width: number; height: number | null } {\n    if (this.options.width) {\n      return { width: this.options.width, height: this.options.height || null };\n    }\n\n    const sizeMap: Record<string, { width: number; height: number | null }> = {\n      small: { width: 400, height: null },\n      medium: { width: 600, height: null },\n      large: { width: 900, height: null },\n      fullscreen: { width: window.innerWidth * 0.95, height: window.innerHeight * 0.9 }\n    };\n\n    return sizeMap[this.options.size || 'medium'] || sizeMap.medium;\n  }\n\n  private createHeader(): void {\n    const doc = getTargetDocument();\n    this.header = doc.createElement('div');\n    this.header.style.cssText = `\n      padding: ${theme.spacing.l};\n      border-bottom: 1px solid rgb(239, 239, 239);\n      background: #ffffff;\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n      flex-shrink: 0;\n      ${this.options.draggable ? 'cursor: move;' : ''}\n    `;\n\n    const titleEl = doc.createElement('h2');\n    titleEl.textContent = this.options.title;\n    titleEl.style.cssText = `\n      margin: 0;\n      font-size: ${theme.typography.fontSize.title};\n      font-weight: ${theme.typography.fontWeight.semibold};\n      color: ${theme.colors.modal.text};\n    `;\n    this.header.appendChild(titleEl);\n\n    if (!this.options.preventClose) {\n      const closeBtn = doc.createElement('button');\n      closeBtn.innerHTML = '×';\n      closeBtn.setAttribute('aria-label', 'Close');\n      closeBtn.style.cssText = `\n        background: none;\n        border: none;\n        font-size: 32px;\n        line-height: 1;\n        color: ${theme.colors.modal.textSecondary};\n        cursor: pointer;\n        padding: 0;\n        width: 32px;\n        height: 32px;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        transition: color 0.2s;\n      `;\n      closeBtn.onmouseover = () => closeBtn.style.color = theme.colors.modal.text;\n      closeBtn.onmouseout = () => closeBtn.style.color = theme.colors.modal.textSecondary;\n      closeBtn.onclick = () => this.close();\n      this.header.appendChild(closeBtn);\n    }\n\n    if (this.options.draggable && this.header) {\n      this.header.onmousedown = (e) => this.startDrag(e);\n    }\n\n    this.modal!.appendChild(this.header);\n  }\n\n  private createBody(): void {\n    const doc = getTargetDocument();\n    this.body = doc.createElement('div');\n    \n    // Count sections to determine styling\n    const sectionCount = \n      (this.options.message ? 1 : 0) +\n      (this.options.content ? 1 : 0) +\n      (this.options.fields && this.options.fields.length > 0 ? 1 : 0);\n    \n    const needsSectionStyling = sectionCount > 1;\n    \n    this.body.style.cssText = `\n      flex: 1;\n      overflow: auto;\n      padding: ${theme.spacing.l};\n      background: ${needsSectionStyling ? '#fafafa' : '#ffffff'};\n    `;\n\n    if (this.options.message) {\n      const messageEl = doc.createElement('p');\n      messageEl.textContent = this.options.message;\n      messageEl.style.cssText = `\n        margin: 0 0 ${needsSectionStyling ? theme.spacing.m : '0'} 0;\n        color: ${theme.colors.modal.textSecondary};\n        font-size: ${theme.typography.fontSize.body};\n        ${needsSectionStyling ? `\n          background: #ffffff;\n          padding: ${theme.spacing.l};\n          border-radius: ${theme.borderRadius.medium};\n          box-shadow: rgba(0, 0, 0, 0.12) 0px 0px 2px, rgba(0, 0, 0, 0.14) 0px 2px 4px;\n        ` : ''}\n      `;\n      this.body.appendChild(messageEl);\n    }\n\n    if (this.options.content) {\n      const contentEl = doc.createElement('div');\n      contentEl.innerHTML = this.options.content;\n      contentEl.style.cssText = `\n        ${needsSectionStyling ? `\n          background: #ffffff;\n          padding: ${theme.spacing.l};\n          border-radius: ${theme.borderRadius.medium};\n          box-shadow: rgba(0, 0, 0, 0.12) 0px 0px 2px, rgba(0, 0, 0, 0.14) 0px 2px 4px;\n        ` : ''}\n        margin-bottom: ${this.options.fields && this.options.fields.length > 0 ? theme.spacing.m : '0'};\n      `;\n      this.body.appendChild(contentEl);\n    }\n\n    if (this.options.fields && this.options.fields.length > 0) {\n      const fieldsContainer = doc.createElement('div');\n      fieldsContainer.style.cssText = `\n        display: flex;\n        flex-direction: column;\n        gap: ${theme.spacing.m};\n        ${needsSectionStyling ? `\n          background: #ffffff;\n          padding: ${theme.spacing.l};\n          border-radius: ${theme.borderRadius.medium};\n          box-shadow: rgba(0, 0, 0, 0.12) 0px 0px 2px, rgba(0, 0, 0, 0.14) 0px 2px 4px;\n        ` : `\n          background: #fafafa;\n          padding: ${theme.spacing.l};\n          border-radius: ${theme.borderRadius.medium};\n        `}\n      `;\n\n      this.options.fields.forEach(field => {\n        const fieldEl = this.createField(field);\n        if (fieldEl) fieldsContainer.appendChild(fieldEl);\n      });\n\n      this.body.appendChild(fieldsContainer);\n    }\n  }\n\n  private createSideCart(): HTMLElement | null {\n    if (!this.options.sideCart?.enabled) return null;\n    \n    const doc = getTargetDocument();\n    const sideCart = doc.createElement('div');\n    const cartWidth = this.options.sideCart.width || 300;\n    const isAttached = this.options.sideCart.attached === true; // Default to false (detached)\n    \n    sideCart.style.cssText = `\n      width: ${cartWidth}px;\n      flex-shrink: 0;\n      background: ${this.options.sideCart.backgroundColor || '#ffffff'};\n      overflow: auto;\n      border-radius: ${theme.borderRadius.medium};\n      ${!isAttached ? `box-shadow: ${theme.shadows.modal};` : ''}\n    `;\n    \n    if (this.options.sideCart.content) {\n      sideCart.innerHTML = this.options.sideCart.content;\n    } else if (this.options.sideCart.imageUrl) {\n      const img = doc.createElement('img');\n      img.src = this.options.sideCart.imageUrl;\n      img.style.cssText = `\n        width: 100%;\n        height: auto;\n        display: block;\n      `;\n      sideCart.appendChild(img);\n    }\n    \n    return sideCart;\n  }\n\n  private createTabs(tabs: FieldConfig[]): HTMLElement {\n    const doc = getTargetDocument();\n    const tabsContainer = doc.createElement('div');\n    tabsContainer.style.cssText = `\n      display: flex;\n      flex-direction: column;\n      gap: ${theme.spacing.m};\n    `;\n    \n    // Tab headers wrapper\n    const tabHeadersWrapper = doc.createElement('div');\n    tabHeadersWrapper.setAttribute('role', 'presentation');\n    tabHeadersWrapper.style.cssText = `\n      min-height: 51px;\n      border-bottom: 2px solid rgb(239, 239, 239);\n    `;\n    \n    // Tab headers list\n    const tabHeaders = doc.createElement('ul');\n    tabHeaders.setAttribute('role', 'tablist');\n    tabHeaders.style.cssText = `\n      display: flex;\n      gap: 0;\n      list-style: none;\n      margin: 0;\n      padding: 0;\n      padding-bottom: 5px;\n    `;\n    \n    // Tab content containers\n    const tabContents = doc.createElement('div');\n    tabContents.style.cssText = `\n      position: relative;\n      min-height: 0;\n    `;\n    \n    const tabContentElements: HTMLElement[] = [];\n    \n    tabs.forEach((tab, index) => {\n      // Create tab header list item\n      const tabHeaderLi = doc.createElement('li');\n      tabHeaderLi.setAttribute('role', 'tab');\n      tabHeaderLi.setAttribute('aria-selected', index === 0 ? 'true' : 'false');\n      tabHeaderLi.setAttribute('aria-label', tab.label || `Tab ${index + 1}`);\n      tabHeaderLi.setAttribute('tabindex', index === 0 ? '0' : '-1');\n      tabHeaderLi.textContent = tab.label || `Tab ${index + 1}`;\n      tabHeaderLi.style.cssText = `\n        padding: 0 0 0 0;\n        margin-right: 20px;\n        background: transparent;\n        border: none;\n        cursor: pointer;\n        font-size: 14px;\n        color: #000;\n        font-weight: ${index === 0 ? 'bold' : 'normal'};\n        line-height: 28px;\n        border-radius: 0;\n        position: relative;\n      `;\n      \n      // Create animated underline element\n      const underline = doc.createElement('div');\n      underline.setAttribute('aria-hidden', 'true');\n      underline.style.cssText = `\n        position: absolute;\n        bottom: -7px;\n        left: 50%;\n        transform: translateX(-50%) scaleX(0);\n        height: 3px;\n        background-color: #0078d4;\n        transition: transform 0.15s ease-out;\n        transform-origin: center;\n        border-radius: 2px 2px 0 0;\n      `;\n      tabHeaderLi.appendChild(underline);\n      \n      // Create tab content\n      const tabContent = doc.createElement('div');\n      tabContent.style.cssText = `\n        display: ${index === 0 ? 'flex' : 'none'};\n        flex-direction: column;\n        gap: ${theme.spacing.m};\n        padding: ${theme.spacing.m} 0;\n      `;\n      \n      if (tab.fields) {\n        tab.fields.forEach(field => {\n          const fieldEl = this.createField(field);\n          if (fieldEl) tabContent.appendChild(fieldEl);\n        });\n      }\n      \n      tabContentElements.push(tabContent);\n      \n      // Tab click handler\n      tabHeaderLi.onclick = () => {\n        // Hide all tabs\n        tabContentElements.forEach((content) => {\n          content.style.display = 'none';\n        });\n        \n        // Reset all tab headers\n        Array.from(tabHeaders.children).forEach((header) => {\n          const headerEl = header as HTMLElement;\n          headerEl.style.fontWeight = 'normal';\n          headerEl.setAttribute('aria-selected', 'false');\n          headerEl.setAttribute('tabindex', '-1');\n          const underlineEl = headerEl.querySelector('div') as HTMLElement;\n          if (underlineEl) {\n            underlineEl.style.transform = 'translateX(-50%) scaleX(0)';\n          }\n        });\n        \n        // Show selected tab\n        tabContent.style.display = 'flex';\n        tabHeaderLi.style.fontWeight = 'bold';\n        tabHeaderLi.setAttribute('aria-selected', 'true');\n        tabHeaderLi.setAttribute('tabindex', '0');\n        \n        // Measure text width and animate underline\n        const textWidth = tabHeaderLi.offsetWidth;\n        const underlineEl = tabHeaderLi.querySelector('div') as HTMLElement;\n        if (underlineEl) {\n          underlineEl.style.width = `${textWidth + 2}px`; // +1px left and right\n          underlineEl.style.transform = 'translateX(-50%) scaleX(1)';\n        }\n      };\n      \n      // Set first tab as active\n      if (index === 0) {\n        tabHeaderLi.style.fontWeight = 'bold';\n        // Measure and set initial underline width\n        setTimeout(() => {\n          const textWidth = tabHeaderLi.offsetWidth;\n          const underlineEl = tabHeaderLi.querySelector('div') as HTMLElement;\n          if (underlineEl) {\n            underlineEl.style.width = `${textWidth + 2}px`;\n            underlineEl.style.transform = 'translateX(-50%) scaleX(1)';\n          }\n        }, 0);\n      }\n      \n      tabHeaders.appendChild(tabHeaderLi);\n      tabContents.appendChild(tabContent);\n    });\n    \n    tabHeadersWrapper.appendChild(tabHeaders);\n    tabsContainer.appendChild(tabHeadersWrapper);\n    tabsContainer.appendChild(tabContents);\n    \n    // After rendering, calculate max height and set it\n    setTimeout(() => {\n      let maxHeight = 0;\n      tabContentElements.forEach((content) => {\n        // Temporarily show to measure\n        const originalDisplay = content.style.display;\n        content.style.display = 'flex';\n        const height = content.scrollHeight;\n        if (height > maxHeight) {\n          maxHeight = height;\n        }\n        content.style.display = originalDisplay;\n      });\n      \n      if (maxHeight > 0) {\n        tabContents.style.minHeight = `${maxHeight}px`;\n      }\n    }, 0);\n    \n    return tabsContainer;\n  }\n\n  private createField(field: FieldConfig): HTMLElement | null {\n    const doc = getTargetDocument();\n    \n    // Handle tabs\n    if (field.asTabs && field.fields) {\n      return this.createTabs(field.fields);\n    }\n    \n    // Handle custom fields\n    if (field.type === 'custom') {\n      if (field.render) {\n        return field.render();\n      } else if (field.html) {\n        const container = doc.createElement('div');\n        container.innerHTML = field.html;\n        return container;\n      }\n      return null;\n    }\n    \n    const container = doc.createElement('div');\n    \n    const labelPosition = field.labelPosition || 'left';\n    \n    container.style.cssText = `\n      display: flex;\n      flex-direction: ${labelPosition === 'top' ? 'column' : 'row'};\n      gap: ${labelPosition === 'top' ? theme.spacing.xs : theme.spacing.m};\n      align-items: ${labelPosition === 'top' ? 'stretch' : 'center'};\n    `;\n\n    if (field.label) {\n      const label = doc.createElement('label');\n      label.textContent = field.label + (field.required ? ' *' : '');\n      label.style.cssText = `\n        display: block;\n        margin-bottom: ${labelPosition === 'top' ? '4px' : '0'};\n        font-style: normal;\n        font-variant: normal;\n        font-weight: normal;\n        font-size: 14px;\n        font-family: 'SegoeUI', 'Segoe UI', ${theme.typography.fontFamily};\n        color: ${theme.colors.modal.text};\n        ${labelPosition === 'left' ? 'min-width: 120px; flex-shrink: 0;' : ''}\n      `;\n      container.appendChild(label);\n    }\n\n    let input: HTMLInputElement | HTMLTextAreaElement | HTMLSelectElement;\n\n    switch (field.type) {\n      case 'textarea':\n        input = doc.createElement('textarea');\n        (input as HTMLTextAreaElement).rows = field.rows || 4;\n        input.setAttribute('autocomplete', 'off');\n        input.setAttribute('autocorrect', 'off');\n        input.setAttribute('autocapitalize', 'off');\n        input.setAttribute('spellcheck', 'false');\n        break;\n      case 'select':\n        input = doc.createElement('select');\n        input.setAttribute('autocomplete', 'off');\n        if (field.options) {\n          field.options.forEach(opt => {\n            const option = doc.createElement('option');\n            if (typeof opt === 'string') {\n              option.value = opt;\n              option.textContent = opt;\n            } else {\n              option.value = opt.value;\n              option.textContent = opt.label;\n            }\n            (input as HTMLSelectElement).appendChild(option);\n          });\n        }\n        break;\n      default:\n        input = doc.createElement('input');\n        input.type = field.type || 'text';\n        input.setAttribute('autocomplete', 'off');\n        input.setAttribute('autocorrect', 'off');\n        input.setAttribute('autocapitalize', 'off');\n        input.setAttribute('spellcheck', 'false');\n        if (field.placeholder) input.placeholder = field.placeholder;\n    }\n\n    input.id = field.id;\n\n    // Determine if this input type needs animated border\n    const needsAnimatedBorder = field.type !== 'checkbox' && field.type !== 'range';\n\n    // Create wrapper for animated border effect\n    const inputWrapper = doc.createElement('div');\n    inputWrapper.style.cssText = `\n      position: relative;\n      width: 100%;\n      ${labelPosition === 'left' ? 'flex: 1;' : ''}\n    `;\n\n    input.style.cssText = `\n      width: 100%;\n      padding: 8px 8px 6px 8px;\n      background-color: white;\n      border: none;\n      border-bottom: 1px solid rgb(216, 216, 216);\n      border-radius: 2px 2px 0 0;\n      font-size: 14px;\n      font-family: ${theme.typography.fontFamily};\n      color: ${theme.colors.modal.inputText};\n      outline: none;\n      min-height: 32px;\n      box-sizing: border-box;\n    `;\n\n    // Create animated bottom border element only for text-like inputs\n    if (needsAnimatedBorder) {\n      const borderElement = doc.createElement('div');\n      borderElement.style.cssText = `\n        position: absolute;\n        left: -1px;\n        right: -1px;\n        bottom: 0;\n        height: 2px;\n        background-color: #0078d4;\n        transform: scaleX(0);\n        transition: transform 0.15s ease-out;\n        border-radius: 0 0 4px 4px;\n        pointer-events: none;\n      `;\n\n      input.onfocus = () => {\n        borderElement.style.transform = 'scaleX(1)';\n      };\n      input.onblur = () => {\n        borderElement.style.transform = 'scaleX(0)';\n      };\n\n      inputWrapper.appendChild(borderElement);\n    }\n\n    if (field.value !== undefined) {\n      if (input instanceof HTMLInputElement && input.type === 'checkbox') {\n        input.checked = Boolean(field.value);\n      } else {\n        input.value = String(field.value);\n      }\n      this.fieldValues.set(field.id, field.value);\n    }\n\n    input.oninput = () => {\n      if (input instanceof HTMLInputElement && input.type === 'checkbox') {\n        this.fieldValues.set(field.id, input.checked);\n      } else {\n        this.fieldValues.set(field.id, input.value);\n      }\n    };\n\n    inputWrapper.appendChild(input);\n    container.appendChild(inputWrapper);\n    return container;\n  }\n\n  private createFooter(): void {\n    const doc = getTargetDocument();\n    this.footer = doc.createElement('div');\n\n    const alignment = this.options.buttonAlignment || 'right';\n    const justifyContent = alignment === 'space-between' ? 'space-between' :\n      alignment === 'center' ? 'center' :\n        alignment === 'left' ? 'flex-start' : 'flex-end';\n\n    this.footer.style.cssText = `\n      padding: ${theme.spacing.l};\n      border-top: 1px solid rgb(239, 239, 239);\n      background: #ffffff;\n      display: flex;\n      justify-content: ${justifyContent};\n      gap: ${theme.spacing.m};\n      flex-shrink: 0;\n    `;\n\n    if (this.options.buttons && this.options.buttons.length > 0) {\n      this.options.buttons.forEach((btn) => {\n        const button = this.createButton(btn);\n        this.footer!.appendChild(button);\n      });\n    }\n\n    this.modal!.appendChild(this.footer);\n  }\n\n  private createButton(btn: ModalButton): HTMLElement {\n    const doc = getTargetDocument();\n    const button = doc.createElement('button');\n    button.textContent = btn.label;\n\n    const isPrimary = btn.setFocus;\n\n    button.style.cssText = `\n      padding: 5px 12px;\n      background: ${isPrimary ? theme.colors.modal.primary : theme.colors.modal.secondary};\n      border: ${isPrimary ? 'none' : `1px solid ${theme.colors.modal.secondaryBorder}`};\n      border-radius: ${theme.borderRadius.small};\n      color: ${isPrimary ? theme.colors.modal.primaryText : theme.colors.modal.secondaryText};\n      font-size: ${theme.typography.fontSize.body};\n      font-weight: ${theme.typography.fontWeight.semibold};\n      font-family: ${theme.typography.fontFamily};\n      cursor: pointer;\n      transition: all 0.2s;\n      min-height: 32px;\n      min-width: 96px;\n    `;\n\n    button.onmouseover = () => {\n      button.style.background = isPrimary\n        ? theme.colors.modal.primaryHover\n        : theme.colors.modal.secondaryHover;\n    };\n\n    button.onmouseout = () => {\n      button.style.background = isPrimary\n        ? theme.colors.modal.primary\n        : theme.colors.modal.secondary;\n    };\n\n    button.onclick = async () => {\n      const result = await btn.callback();\n\n      if (result !== false && !btn.preventClose) {\n        if (this.resolvePromise) {\n          this.resolvePromise({ button: btn, data: this.getFieldValues() });\n        }\n        this.close();\n      }\n    };\n\n    if (btn.setFocus) {\n      setTimeout(() => button.focus(), 100);\n    }\n\n    return button;\n  }\n\n  private startDrag(e: MouseEvent): void {\n    if (!this.options.draggable || !this.container) return;\n\n    this.isDragging = true;\n    this.dragStartX = e.clientX;\n    this.dragStartY = e.clientY;\n\n    const rect = this.container.getBoundingClientRect();\n    this.modalStartX = rect.left;\n    this.modalStartY = rect.top;\n\n    const doc = getTargetDocument();\n    doc.addEventListener('mousemove', this.handleDrag);\n    doc.addEventListener('mouseup', this.stopDrag);\n\n    e.preventDefault();\n  }\n\n  private handleDrag = (e: MouseEvent): void => {\n    if (!this.isDragging || !this.container) return;\n\n    const deltaX = e.clientX - this.dragStartX;\n    const deltaY = e.clientY - this.dragStartY;\n\n    const newX = this.modalStartX + deltaX;\n    const newY = this.modalStartY + deltaY;\n\n    this.container.style.transform = 'none';\n    this.container.style.left = `${newX}px`;\n    this.container.style.top = `${newY}px`;\n    this.container.style.margin = '0';\n  };\n\n  private stopDrag = (): void => {\n    this.isDragging = false;\n\n    const doc = getTargetDocument();\n    doc.removeEventListener('mousemove', this.handleDrag);\n    doc.removeEventListener('mouseup', this.stopDrag);\n  };\n\n  private handleEscapeKey = (e: KeyboardEvent): void => {\n    if (e.key === 'Escape' && this.options.allowEscapeClose) {\n      this.close();\n    }\n  };\n\n  show(): void {\n    const doc = getTargetDocument();\n    if (this.overlay && this.container) {\n      doc.body.appendChild(this.overlay);\n      doc.body.appendChild(this.container);\n      doc.body.style.overflow = 'hidden';\n    }\n  }\n\n  showAsync(): Promise<ModalResponse> {\n    return new Promise((resolve) => {\n      this.resolvePromise = resolve;\n      this.show();\n    });\n  }\n\n  close(): void {\n    const doc = getTargetDocument();\n\n    doc.removeEventListener('keydown', this.handleEscapeKey);\n    doc.removeEventListener('mousemove', this.handleDrag);\n    doc.removeEventListener('mouseup', this.stopDrag);\n\n    if (this.container) {\n      this.container.style.animation = 'fadeOutScale 0.2s ease-in';\n    }\n    if (this.overlay) {\n      this.overlay.style.animation = 'fadeOut 0.2s ease-in';\n    }\n\n    setTimeout(() => {\n      if (this.container?.parentElement) {\n        this.container.parentElement.removeChild(this.container);\n      }\n      if (this.overlay?.parentElement) {\n        this.overlay.parentElement.removeChild(this.overlay);\n      }\n      doc.body.style.overflow = '';\n    }, 200);\n  }\n\n  setLoading(loading: boolean, message?: string): void {\n    const doc = getTargetDocument();\n\n    if (loading) {\n      if (!this.loadingOverlay && this.modal) {\n        this.loadingOverlay = doc.createElement('div');\n        this.loadingOverlay.style.cssText = `\n          position: absolute;\n          top: 0;\n          left: 0;\n          width: 100%;\n          height: 100%;\n          background: rgba(255, 255, 255, 0.9);\n          display: flex;\n          flex-direction: column;\n          align-items: center;\n          justify-content: center;\n          gap: ${theme.spacing.m};\n          z-index: 10;\n        `;\n\n        const spinner = doc.createElement('div');\n        spinner.style.cssText = `\n          width: 48px;\n          height: 48px;\n          border: 4px solid ${theme.colors.modal.divider};\n          border-top-color: ${theme.colors.modal.primary};\n          border-radius: 50%;\n          animation: spin 1s linear infinite;\n        `;\n\n        this.loadingOverlay.appendChild(spinner);\n\n        if (message) {\n          const messageEl = doc.createElement('div');\n          messageEl.textContent = message;\n          messageEl.style.cssText = `\n            color: ${theme.colors.modal.text};\n            font-size: ${theme.typography.fontSize.body};\n          `;\n          this.loadingOverlay.appendChild(messageEl);\n        }\n\n        this.modal.appendChild(this.loadingOverlay);\n      }\n    } else {\n      if (this.loadingOverlay?.parentElement) {\n        this.loadingOverlay.parentElement.removeChild(this.loadingOverlay);\n        this.loadingOverlay = null;\n      }\n    }\n  }\n\n  updateProgress(step: number, _skipValidation?: boolean): void {\n    this.currentStep = step;\n  }\n\n  nextStep(): void {\n    this.currentStep++;\n    this.updateProgress(this.currentStep);\n  }\n\n  previousStep(): void {\n    if (this.currentStep > 1) {\n      this.currentStep--;\n      this.updateProgress(this.currentStep);\n    }\n  }\n\n  goToStep(_stepId: string): void {\n    // TODO: Implement\n  }\n\n  getFieldValue(fieldId: string): any {\n    return this.fieldValues.get(fieldId);\n  }\n\n  getFieldValues(): Record<string, any> {\n    const values: Record<string, any> = {};\n    this.fieldValues.forEach((value, key) => {\n      values[key] = value;\n    });\n    return values;\n  }\n\n  validateCurrentStep(): boolean {\n    return true;\n  }\n\n  validateAllFields(): boolean {\n    return true;\n  }\n\n  updateSideCart(_content: string | { imageUrl: string }): void {\n    // TODO: Implement\n  }\n\n  clearAutoSave(): void {\n    // TODO: Implement\n  }\n\n  getElement(selector?: string): HTMLElement | HTMLElement[] | null {\n    if (!selector) return this.modal;\n    if (this.modal) {\n      const elements = this.modal.querySelectorAll(selector);\n      return elements.length === 1 ? elements[0] as HTMLElement : Array.from(elements) as HTMLElement[];\n    }\n    return null;\n  }\n\n  title(title: string): this {\n    this.options.title = title;\n    if (this.header) {\n      const titleEl = this.header.querySelector('h2');\n      if (titleEl) titleEl.textContent = title;\n    }\n    return this;\n  }\n\n  message(message: string): this {\n    this.options.message = message;\n    return this;\n  }\n\n  content(content: string): this {\n    this.options.content = content;\n    return this;\n  }\n\n  width(width: number): this {\n    this.options.width = width;\n    if (this.modal) {\n      this.modal.style.width = `${width}px`;\n    }\n    return this;\n  }\n\n  height(height: number): this {\n    this.options.height = height;\n    if (this.modal) {\n      this.modal.style.height = `${height}px`;\n    }\n    return this;\n  }\n\n  static open(options: ModalOptions): Modal {\n    const modal = new Modal(options);\n    modal.show();\n    return modal;\n  }\n\n  static alert(title: string, message: string, options?: Partial<ModalOptions>): Promise<void> {\n    return new Promise((resolve) => {\n      Modal.open({\n        title,\n        message,\n        size: 'small',\n        ...options,\n        buttons: [\n          new ModalButton('OK', () => {\n            resolve();\n          }, true)\n        ]\n      });\n    });\n  }\n\n  static confirm(title: string, message: string, options?: Partial<ModalOptions>): Promise<boolean> {\n    return new Promise((resolve) => {\n      Modal.open({\n        title,\n        message,\n        size: 'small',\n        ...options,\n        buttons: [\n          new ModalButton('Cancel', () => {\n            resolve(false);\n          }),\n          new ModalButton('OK', () => {\n            resolve(true);\n          }, true)\n        ]\n      });\n    });\n  }\n\n  /**\n   * Show a D365 web resource in the modal\n   * @param webResourcePath - Path to the web resource (e.g., 'abdg_/html/datagrid.htm?data=ProductQuotedHistory&id=123')\n   */\n  showWebResource(webResourcePath: string): void {\n    const doc = getTargetDocument();\n    \n    if (!this.body) return;\n    \n    // Clear existing body content\n    this.body.innerHTML = '';\n    \n    // Reset body styling for iframe\n    this.body.style.cssText = `\n      flex: 1;\n      overflow: hidden;\n      padding: 0;\n      background: #ffffff;\n    `;\n    \n    // Create iframe\n    const iframe = doc.createElement('iframe');\n    iframe.style.cssText = `\n      width: 100%;\n      height: 100%;\n      border: none;\n      display: block;\n    `;\n    \n    // Construct the full URL for the web resource\n    const baseUrl = window.location.origin;\n    const fullUrl = webResourcePath.startsWith('http') \n      ? webResourcePath \n      : `${baseUrl}/WebResources/${webResourcePath}`;\n    \n    iframe.src = fullUrl;\n    \n    this.body.appendChild(iframe);\n    \n    // Show the modal if not already visible\n    if (!this.overlay?.parentElement) {\n      this.show();\n    }\n  }\n}\n\nexport { ModalButton } from './Modal.types';\n","/**\r\n * Modal helper functions for common dialog patterns\r\n * TEMPORARY STUBS - Full implementation pending Modal.ts recreation\r\n */\r\n\r\n// import { Modal } from './Modal';\r\nimport { ModalButton } from './Modal.types';\r\nimport type { ModalOptions } from './Modal.types';\r\n\r\n// Temporary stub\r\nconst Modal: any = class {};\r\n\r\n/**\r\n * Show a simple alert dialog\r\n */\r\nexport function alert(\r\n  title: string,\r\n  message: string,\r\n  options?: Partial<ModalOptions>\r\n): Promise<void> {\r\n  return new Promise((resolve) => {\r\n    new Modal({\r\n      title,\r\n      message,\r\n      icon: options?.icon || 'INFO',\r\n      size: 'small',\r\n      ...options,\r\n      buttons: [\r\n        new ModalButton('OK', () => resolve(), true)\r\n      ]\r\n    }).show();\r\n  });\r\n}\r\n\r\n/**\r\n * Show a confirmation dialog\r\n */\r\nexport function confirm(\r\n  title: string,\r\n  message: string,\r\n  options?: Partial<ModalOptions>\r\n): Promise<boolean> {\r\n  return new Promise((resolve) => {\r\n    new Modal({\r\n      title,\r\n      message,\r\n      icon: options?.icon || 'QUESTION',\r\n      size: 'small',\r\n      ...options,\r\n      buttons: [\r\n        new ModalButton('Cancel', () => resolve(false)),\r\n        new ModalButton('OK', () => resolve(true), true)\r\n      ]\r\n    }).show();\r\n  });\r\n}\r\n\r\n/**\r\n * Show a prompt dialog\r\n */\r\nexport function prompt(\r\n  title: string,\r\n  message: string,\r\n  defaultValue?: string,\r\n  options?: Partial<ModalOptions>\r\n): Promise<string | null> {\r\n  return new Promise((resolve) => {\r\n    const modal = new Modal({\r\n      title,\r\n      message,\r\n      icon: options?.icon || 'QUESTION',\r\n      size: 'small',\r\n      ...options,\r\n      fields: [\r\n        {\r\n          id: 'promptValue',\r\n          type: 'text',\r\n          value: defaultValue || '',\r\n          placeholder: 'Enter value...'\r\n        }\r\n      ],\r\n      buttons: [\r\n        new ModalButton('Cancel', () => resolve(null)),\r\n        new ModalButton('OK', () => {\r\n          const value = modal.getFieldValue('promptValue');\r\n          resolve(value || '');\r\n        }, true)\r\n      ]\r\n    });\r\n    \r\n    modal.show();\r\n  });\r\n}\r\n","/**\r\n * DOM utility functions for D365 compatibility\r\n */\r\n\r\n/**\r\n * Get the target document for rendering\r\n * Supports D365 iframes by checking parent window\r\n */\r\nexport function getTargetDocument(): Document {\r\n  try {\r\n    // Check if we're in an iframe and can access parent\r\n    if (window.self !== window.top && window.top) {\r\n      return window.top.document;\r\n    }\r\n  } catch (e) {\r\n    // Cross-origin iframe, can't access parent\r\n  }\r\n  \r\n  return document;\r\n}\r\n\r\n/**\r\n * Get the target window for rendering\r\n */\r\nexport function getTargetWindow(): Window {\r\n  return (window.parent || window) as Window;\r\n}\r\n","/**\r\n * Lookup Component\r\n * Advanced entity record lookup with table display, search, pagination\r\n */\r\n\r\nimport { theme } from '../../styles/theme';\r\nimport type { LookupOptions, LookupResult, EntityMetadata } from './Lookup.types';\r\nimport { getTargetDocument } from '../../utils/dom';\r\n\r\n// Metadata cache to avoid repeated API calls\r\nconst metadataCache: Map<string, EntityMetadata> = new Map();\r\n\r\n// Mock data generator for when Xrm is not available\r\nfunction generateMockData(entity: string, count: number = 50): any[] {\r\n  const mockData: any[] = [];\r\n  \r\n  const firstNames = ['John', 'Jane', 'Michael', 'Sarah', 'David', 'Emily', 'Robert', 'Lisa', 'William', 'Jennifer'];\r\n  const lastNames = ['Smith', 'Johnson', 'Williams', 'Brown', 'Jones', 'Garcia', 'Miller', 'Davis', 'Rodriguez', 'Martinez'];\r\n  const companies = ['Acme Corp', 'TechCo', 'Global Industries', 'Innovation Labs', 'Premier Solutions', 'Summit Group', 'Venture Partners', 'Elite Services'];\r\n  const cities = ['New York', 'Los Angeles', 'Chicago', 'Houston', 'Phoenix', 'Philadelphia', 'San Antonio', 'San Diego'];\r\n  \r\n  for (let i = 0; i < count; i++) {\r\n    const id = `${i + 1}`.padStart(8, '0') + '-0000-0000-0000-000000000000';\r\n    \r\n    if (entity === 'account') {\r\n      const company = companies[i % companies.length];\r\n      mockData.push({\r\n        accountid: id,\r\n        name: `${company} ${i > 7 ? i - 7 : ''}`.trim(),\r\n        accountnumber: `ACC-${1000 + i}`,\r\n        telephone1: `555-${Math.floor(Math.random() * 900 + 100)}-${Math.floor(Math.random() * 9000 + 1000)}`,\r\n        emailaddress1: `contact@${company.toLowerCase().replace(/\\s/g, '')}.com`,\r\n        address1_city: cities[i % cities.length],\r\n        revenue: Math.floor(Math.random() * 10000000),\r\n        websiteurl: `https://www.${company.toLowerCase().replace(/\\s/g, '')}.com`,\r\n        createdon: new Date(Date.now() - Math.random() * 365 * 24 * 60 * 60 * 1000).toISOString()\r\n      });\r\n    } else if (entity === 'contact') {\r\n      const firstName = firstNames[i % firstNames.length];\r\n      const lastName = lastNames[Math.floor(i / firstNames.length) % lastNames.length];\r\n      mockData.push({\r\n        contactid: id,\r\n        fullname: `${firstName} ${lastName}`,\r\n        name: `${firstName} ${lastName}`,\r\n        firstname: firstName,\r\n        lastname: lastName,\r\n        emailaddress1: `${firstName.toLowerCase()}.${lastName.toLowerCase()}@example.com`,\r\n        telephone1: `555-${Math.floor(Math.random() * 900 + 100)}-${Math.floor(Math.random() * 9000 + 1000)}`,\r\n        jobtitle: ['Manager', 'Director', 'VP', 'Analyst', 'Specialist'][i % 5],\r\n        parentcustomerid: companies[i % companies.length],\r\n        createdon: new Date(Date.now() - Math.random() * 365 * 24 * 60 * 60 * 1000).toISOString()\r\n      });\r\n    } else {\r\n      // Generic entity\r\n      mockData.push({\r\n        [`${entity}id`]: id,\r\n        name: `${entity.charAt(0).toUpperCase() + entity.slice(1)} Record ${i + 1}`,\r\n        createdon: new Date(Date.now() - Math.random() * 365 * 24 * 60 * 60 * 1000).toISOString()\r\n      });\r\n    }\r\n  }\r\n  \r\n  return mockData;\r\n}\r\n\r\n// Fetch entity metadata\r\nasync function getEntityMetadata(entityName: string): Promise<EntityMetadata | null> {\r\n  // Check cache first\r\n  if (metadataCache.has(entityName)) {\r\n    return metadataCache.get(entityName)!;\r\n  }\r\n  \r\n  // Try to use Xrm API if available\r\n  if (typeof window !== 'undefined' && window.Xrm?.Utility?.getEntityMetadata) {\r\n    try {\r\n      const metadata = await window.Xrm.Utility.getEntityMetadata(entityName);\r\n      metadataCache.set(entityName, metadata);\r\n      return metadata;\r\n    } catch (error) {\r\n      console.warn(`Failed to fetch metadata for ${entityName}:`, error);\r\n    }\r\n  }\r\n  \r\n  // Return mock metadata if Xrm not available\r\n  const mockMetadata: EntityMetadata = {\r\n    EntitySetName: `${entityName}s`,\r\n    PrimaryIdAttribute: `${entityName}id`,\r\n    PrimaryNameAttribute: entityName === 'account' ? 'name' : entityName === 'contact' ? 'fullname' : 'name',\r\n    DisplayName: { UserLocalizedLabel: { Label: entityName.charAt(0).toUpperCase() + entityName.slice(1) } },\r\n    Attributes: []\r\n  };\r\n  \r\n  metadataCache.set(entityName, mockMetadata);\r\n  return mockMetadata;\r\n}\r\n\r\n// Fetch entity records\r\nasync function fetchRecords(\r\n  entity: string,\r\n  columns: string[],\r\n  filters?: string,\r\n  orderBy?: Array<{ attribute: string; descending?: boolean }>,\r\n  pageNumber: number = 1,\r\n  pageSize: number = 50,\r\n  searchTerm?: string,\r\n  searchFields?: string[]\r\n): Promise<{ entities: any[]; totalCount: number }> {\r\n  \r\n  // Try to use Xrm API if available\r\n  if (typeof window !== 'undefined' && window.Xrm?.WebApi?.retrieveMultipleRecords) {\r\n    try {\r\n      // Combine columns with search fields to ensure all searchable fields are fetched\r\n      const allColumns = [...new Set([...columns, ...(searchFields || [])])];\r\n      \r\n      let fetchXml = `<fetch mapping='logical' page='${pageNumber}' count='${pageSize}' returntotalrecordcount='true'>\r\n        <entity name='${entity}'>`;\r\n      \r\n      allColumns.forEach(col => {\r\n        fetchXml += `<attribute name='${col}' />`;\r\n      });\r\n      \r\n      // Add search filter if provided\r\n      let combinedFilters = '';\r\n      if (searchTerm && searchFields && searchFields.length > 0) {\r\n        let searchFilter = '<filter type=\"or\">';\r\n        searchFields.forEach(field => {\r\n          // Use 'like' operator for contains behavior\r\n          searchFilter += `<condition attribute='${field}' operator='like' value='%${searchTerm}%' />`;\r\n        });\r\n        searchFilter += '</filter>';\r\n        \r\n        if (filters) {\r\n          combinedFilters = `<filter type=\"and\">${searchFilter}${filters}</filter>`;\r\n        } else {\r\n          combinedFilters = searchFilter;\r\n        }\r\n      } else if (filters) {\r\n        combinedFilters = filters;\r\n      }\r\n      \r\n      if (combinedFilters) {\r\n        fetchXml += combinedFilters;\r\n      }\r\n      \r\n      if (orderBy && orderBy.length > 0) {\r\n        orderBy.forEach(order => {\r\n          fetchXml += `<order attribute='${order.attribute}' ${order.descending ? \"descending='true'\" : ''} />`;\r\n        });\r\n      }\r\n      \r\n      fetchXml += `</entity></fetch>`;\r\n      \r\n      const result = await window.Xrm.WebApi.retrieveMultipleRecords(entity, `?fetchXml=${encodeURIComponent(fetchXml)}`);\r\n      \r\n      return {\r\n        entities: result.entities || [],\r\n        totalCount: parseInt(result['@Microsoft.Dynamics.CRM.totalrecordcount'] || result.entities?.length || '0', 10)\r\n      };\r\n    } catch (error) {\r\n      console.warn(`Failed to fetch ${entity} records via Xrm.WebApi:`, error);\r\n    }\r\n  }\r\n  \r\n  // Fall back to mock data\r\n  console.log(`Using mock data for entity: ${entity}`);\r\n  const allMockData = generateMockData(entity, 100);\r\n  \r\n  // Apply search filter for mock data (contains)\r\n  let filteredData = allMockData;\r\n  if (searchTerm && searchFields && searchFields.length > 0) {\r\n    const lowerSearch = searchTerm.toLowerCase();\r\n    filteredData = allMockData.filter(record => {\r\n      return searchFields.some(field => {\r\n        const value = record[field];\r\n        if (value === null || value === undefined) return false;\r\n        return String(value).toLowerCase().includes(lowerSearch);\r\n      });\r\n    });\r\n  }\r\n  \r\n  // Apply ordering\r\n  if (orderBy && orderBy.length > 0) {\r\n    const order = orderBy[0];\r\n    filteredData.sort((a, b) => {\r\n      const aVal = a[order.attribute];\r\n      const bVal = b[order.attribute];\r\n      const comparison = aVal > bVal ? 1 : aVal < bVal ? -1 : 0;\r\n      return order.descending ? -comparison : comparison;\r\n    });\r\n  }\r\n  \r\n  // Apply pagination\r\n  const start = (pageNumber - 1) * pageSize;\r\n  const end = start + pageSize;\r\n  const paginatedData = filteredData.slice(start, end);\r\n  \r\n  return {\r\n    entities: paginatedData,\r\n    totalCount: filteredData.length\r\n  };\r\n}\r\n\r\n// Format value for display\r\nfunction formatValue(value: any, attributeType?: string): string {\r\n  if (value === null || value === undefined) {\r\n    return '';\r\n  }\r\n  \r\n  if (attributeType === 'DateTime' || value instanceof Date || /^\\d{4}-\\d{2}-\\d{2}T/.test(value)) {\r\n    try {\r\n      const date = new Date(value);\r\n      return date.toLocaleDateString() + ' ' + date.toLocaleTimeString();\r\n    } catch {\r\n      return String(value);\r\n    }\r\n  }\r\n  \r\n  if (typeof value === 'number') {\r\n    return value.toLocaleString();\r\n  }\r\n  \r\n  if (typeof value === 'object' && value._value !== undefined) {\r\n    // Lookup field\r\n    return value._value || '';\r\n  }\r\n  \r\n  return String(value);\r\n}\r\n\r\nexport class Lookup {\r\n  private static activeInstance: Lookup | null = null;\r\n  \r\n  private options: Required<LookupOptions>;\r\n  private container: HTMLDivElement;\r\n  private overlay: HTMLDivElement;\r\n  private modal: HTMLDivElement;\r\n  private tableContainer: HTMLDivElement | null = null;\r\n  private tableBody: HTMLTableSectionElement | null = null;\r\n  private searchInput: HTMLInputElement | null = null;\r\n  private paginationInfo: HTMLSpanElement | null = null;\r\n  \r\n  private currentPage: number = 1;\r\n  private totalRecords: number = 0;\r\n  private records: any[] = [];\r\n  private allLoadedRecords: any[] = []; // Store all loaded records for infinite scroll\r\n  private selectedRecords: Set<string> = new Set();\r\n  private searchDebounceTimer: number = 0;\r\n  private columnLabels: Map<string, string> = new Map();\r\n  private sortColumn: string | null = null;\r\n  private sortDescending: boolean = false;\r\n  private isLoadingMore: boolean = false;\r\n  private hasMoreRecords: boolean = true;\r\n  \r\n  private constructor(options: LookupOptions) {\r\n    // Set defaults\r\n    this.options = {\r\n      entity: options.entity || 'account',\r\n      columns: options.columns,\r\n      columnLabels: options.columnLabels || {},\r\n      filters: options.filters || '',\r\n      orderBy: options.orderBy || [],\r\n      multiSelect: options.multiSelect ?? false,\r\n      searchFields: options.searchFields || options.columns,\r\n      additionalSearchFields: options.additionalSearchFields || [],\r\n      defaultSearchTerm: options.defaultSearchTerm || '',\r\n      title: options.title || `Select ${options.entity?.charAt(0).toUpperCase()}${options.entity?.slice(1)}`,\r\n      width: options.width || 900,\r\n      height: options.height || 600,\r\n      pageSize: options.pageSize || 50,\r\n      showPagination: options.showPagination ?? true,\r\n      allowClear: options.allowClear ?? false,\r\n      onSelect: options.onSelect,\r\n      onCancel: options.onCancel || (() => {})\r\n    };\r\n    \r\n    const doc = getTargetDocument();\r\n    \r\n    // Create overlay\r\n    this.overlay = doc.createElement('div');\r\n    this.overlay.style.cssText = `\r\n      position: fixed;\r\n      top: 0;\r\n      left: 0;\r\n      width: 100%;\r\n      height: 100%;\r\n      background: ${theme.colors.modal.overlay};\r\n      z-index: ${theme.zIndex.modal - 1};\r\n      animation: fadeIn 0.2s ease-out;\r\n    `;\r\n    \r\n    // Create modal container\r\n    this.container = doc.createElement('div');\r\n    this.container.style.cssText = `\r\n      position: fixed;\r\n      top: 50%;\r\n      left: 50%;\r\n      transform: translate(-50%, -50%);\r\n      z-index: ${theme.zIndex.modal};\r\n      animation: fadeInScale 0.3s ease-out;\r\n    `;\r\n    \r\n    // Create modal\r\n    this.modal = doc.createElement('div');\r\n    this.modal.style.cssText = `\r\n      background: ${theme.colors.modal.background};\r\n      border-radius: ${theme.borderRadius.medium};\r\n      box-shadow: ${theme.shadows.modal};\r\n      width: ${this.options.width}px;\r\n      max-width: 95vw;\r\n      height: ${this.options.height}px;\r\n      max-height: 90vh;\r\n      display: flex;\r\n      flex-direction: column;\r\n      overflow: hidden;\r\n    `;\r\n    \r\n    this.container.appendChild(this.modal);\r\n    \r\n    this.render();\r\n  }\r\n  \r\n  private async render(): Promise<void> {\r\n    // Header\r\n    const header = this.createHeader();\r\n    this.modal.appendChild(header);\r\n    \r\n    // Search bar\r\n    const searchBar = this.createSearchBar();\r\n    this.modal.appendChild(searchBar);\r\n    \r\n    // Table container\r\n    const tableContainer = this.createTableContainer();\r\n    this.modal.appendChild(tableContainer);\r\n    \r\n    // Pagination\r\n    if (this.options.showPagination) {\r\n      const pagination = this.createPagination();\r\n      this.modal.appendChild(pagination);\r\n    }\r\n    \r\n    // Footer\r\n    const footer = this.createFooter();\r\n    this.modal.appendChild(footer);\r\n    \r\n    // Load column labels and initial data\r\n    await this.loadColumnLabels();\r\n    await this.loadData();\r\n  }\r\n  \r\n  private createHeader(): HTMLDivElement {\r\n    const header = getTargetDocument().createElement('div');\r\n    header.style.cssText = `\r\n      padding: ${theme.spacing.l};\r\n      border-bottom: 1px solid ${theme.colors.modal.divider};\r\n      display: flex;\r\n      justify-content: space-between;\r\n      align-items: center;\r\n      flex-shrink: 0;\r\n    `;\r\n    \r\n    const title = getTargetDocument().createElement('h2');\r\n    title.textContent = this.options.title;\r\n    title.style.cssText = `\r\n      margin: 0;\r\n      font-size: ${theme.typography.fontSize.title};\r\n      font-weight: ${theme.typography.fontWeight.semibold};\r\n      color: ${theme.colors.modal.text};\r\n    `;\r\n    \r\n    const closeButton = getTargetDocument().createElement('button');\r\n    closeButton.innerHTML = '×';\r\n    closeButton.style.cssText = `\r\n      background: none;\r\n      border: none;\r\n      font-size: 32px;\r\n      line-height: 1;\r\n      color: ${theme.colors.modal.textSecondary};\r\n      cursor: pointer;\r\n      padding: 0;\r\n      width: 32px;\r\n      height: 32px;\r\n      display: flex;\r\n      align-items: center;\r\n      justify-content: center;\r\n      transition: color 0.2s;\r\n    `;\r\n    closeButton.onmouseover = () => closeButton.style.color = theme.colors.modal.text;\r\n    closeButton.onmouseout = () => closeButton.style.color = theme.colors.modal.textSecondary;\r\n    closeButton.onclick = () => this.cancel();\r\n    \r\n    header.appendChild(title);\r\n    header.appendChild(closeButton);\r\n    \r\n    return header;\r\n  }\r\n  \r\n  private createSearchBar(): HTMLDivElement {\r\n    const searchBar = getTargetDocument().createElement('div');\r\n    searchBar.style.cssText = `\r\n      padding: ${theme.spacing.m} ${theme.spacing.l};\r\n      border-bottom: 1px solid ${theme.colors.modal.divider};\r\n      flex-shrink: 0;\r\n    `;\r\n    \r\n    // Create wrapper for animated border effect\r\n    const inputWrapper = getTargetDocument().createElement('div');\r\n    inputWrapper.style.cssText = `\r\n      position: relative;\r\n      width: 100%;\r\n      display: flex;\r\n      align-items: center;\r\n    `;\r\n    \r\n    // Add Fluent UI magnifying glass icon\r\n    const searchIcon = getTargetDocument().createElement('span');\r\n    searchIcon.innerHTML = '🔍';\r\n    searchIcon.style.cssText = `\r\n      position: absolute;\r\n      left: ${theme.spacing.s};\r\n      top: 50%;\r\n      transform: translateY(-50%);\r\n      font-size: 16px;\r\n      color: ${theme.colors.modal.textSecondary};\r\n      pointer-events: none;\r\n      z-index: 1;\r\n    `;\r\n    \r\n    this.searchInput = getTargetDocument().createElement('input');\r\n    this.searchInput.type = 'text';\r\n    this.searchInput.placeholder = 'Search...';\r\n    this.searchInput.value = this.options.defaultSearchTerm;\r\n    this.searchInput.style.cssText = `\r\n      width: 100%;\r\n      padding: ${theme.spacing.s} ${theme.spacing.m};\r\n      padding-left: 36px;\r\n      background-color: ${theme.colors.modal.inputBackground};\r\n      border: none;\r\n      border-bottom: 1px solid ${theme.colors.modal.inputBorderBottom};\r\n      border-radius: ${theme.borderRadius.small};\r\n      font-size: ${theme.typography.fontSize.body};\r\n      font-family: ${theme.typography.fontFamily};\r\n      color: ${theme.colors.modal.inputText};\r\n      outline: none;\r\n      min-height: 32px;\r\n      box-sizing: border-box;\r\n    `;\r\n    \r\n    // Create animated bottom border element\r\n    const borderElement = getTargetDocument().createElement('div');\r\n    borderElement.style.cssText = `\r\n      content: \"\";\r\n      position: absolute;\r\n      right: -1px;\r\n      left: -1px;\r\n      bottom: 0;\r\n      height: 2px;\r\n      background-color: ${theme.colors.modal.inputBorderFocus};\r\n      transform: scaleX(0);\r\n      transition: transform 0.01ms;\r\n      transition-delay: 0.01ms;\r\n      border-bottom-left-radius: 4px;\r\n      border-bottom-right-radius: 4px;\r\n      pointer-events: none;\r\n    `;\r\n    \r\n    this.searchInput.onfocus = () => {\r\n      borderElement.style.transform = 'scaleX(1)';\r\n      borderElement.style.transitionDuration = '0.15s';\r\n      borderElement.style.transitionDelay = '0s';\r\n    };\r\n    \r\n    this.searchInput.onblur = () => {\r\n      borderElement.style.transform = 'scaleX(0)';\r\n      borderElement.style.transitionDuration = '0.01ms';\r\n      borderElement.style.transitionDelay = '0.01ms';\r\n    };\r\n    \r\n    this.searchInput.oninput = () => this.handleSearch();\r\n    \r\n    inputWrapper.appendChild(searchIcon);\r\n    inputWrapper.appendChild(this.searchInput);\r\n    inputWrapper.appendChild(borderElement);\r\n    searchBar.appendChild(inputWrapper);\r\n    \r\n    return searchBar;\r\n  }\r\n  \r\n  private createTableContainer(): HTMLDivElement {\r\n    this.tableContainer = getTargetDocument().createElement('div');\r\n    this.tableContainer.style.cssText = `\r\n      flex: 1;\r\n      overflow: auto;\r\n      padding: ${theme.spacing.m} ${theme.spacing.l};\r\n    `;\r\n    \r\n    // Add infinite scroll listener\r\n    this.tableContainer.onscroll = () => this.handleScroll();\r\n    \r\n    const table = getTargetDocument().createElement('table');\r\n    table.style.cssText = `\r\n      width: 100%;\r\n      border-collapse: collapse;\r\n      font-size: ${theme.typography.fontSize.body};\r\n    `;\r\n    \r\n    // Table header\r\n    const thead = getTargetDocument().createElement('thead');\r\n    const headerRow = getTargetDocument().createElement('tr');\r\n    \r\n    // Checkbox column for multi-select\r\n    if (this.options.multiSelect) {\r\n      const th = getTargetDocument().createElement('th');\r\n      th.style.cssText = `\r\n        padding: ${theme.spacing.s};\r\n        text-align: left;\r\n        border-bottom: 2px solid ${theme.colors.modal.divider};\r\n        font-weight: ${theme.typography.fontWeight.semibold};\r\n        color: ${theme.colors.modal.text};\r\n        width: 40px;\r\n      `;\r\n      headerRow.appendChild(th);\r\n    }\r\n    \r\n    // Data columns\r\n    this.options.columns.forEach(column => {\r\n      const th = getTargetDocument().createElement('th');\r\n      th.style.cssText = `\r\n        padding: ${theme.spacing.s};\r\n        text-align: left;\r\n        border-bottom: 2px solid ${theme.colors.modal.divider};\r\n        font-weight: ${theme.typography.fontWeight.semibold};\r\n        color: ${theme.colors.modal.text};\r\n        cursor: pointer;\r\n        user-select: none;\r\n      `;\r\n      \r\n      th.onclick = () => this.handleSort(column);\r\n      th.onmouseover = () => th.style.background = theme.colors.neutralLighter;\r\n      th.onmouseout = () => th.style.background = 'transparent';\r\n      \r\n      const label = this.columnLabels.get(column) || column;\r\n      th.textContent = label;\r\n      \r\n      headerRow.appendChild(th);\r\n    });\r\n    \r\n    thead.appendChild(headerRow);\r\n    table.appendChild(thead);\r\n    \r\n    // Table body\r\n    this.tableBody = getTargetDocument().createElement('tbody');\r\n    table.appendChild(this.tableBody);\r\n    \r\n    this.tableContainer.appendChild(table);\r\n    \r\n    return this.tableContainer;\r\n  }\r\n  \r\n  private createPagination(): HTMLDivElement {\r\n    const pagination = getTargetDocument().createElement('div');\r\n    pagination.style.cssText = `\r\n      padding: ${theme.spacing.m} ${theme.spacing.l};\r\n      border-top: 1px solid ${theme.colors.modal.divider};\r\n      display: flex;\r\n      justify-content: center;\r\n      align-items: center;\r\n      gap: ${theme.spacing.m};\r\n      flex-shrink: 0;\r\n    `;\r\n    \r\n    // Just show record count for infinite scroll\r\n    this.paginationInfo = getTargetDocument().createElement('span');\r\n    this.paginationInfo.style.cssText = `\r\n      color: ${theme.colors.modal.textSecondary};\r\n      font-size: ${theme.typography.fontSize.body};\r\n    `;\r\n    \r\n    pagination.appendChild(this.paginationInfo);\r\n    \r\n    return pagination;\r\n  }\r\n  \r\n  private createFooter(): HTMLDivElement {\r\n    const footer = getTargetDocument().createElement('div');\r\n    footer.style.cssText = `\r\n      padding: ${theme.spacing.l};\r\n      border-top: 1px solid ${theme.colors.modal.divider};\r\n      display: flex;\r\n      justify-content: flex-end;\r\n      gap: ${theme.spacing.m};\r\n      flex-shrink: 0;\r\n    `;\r\n    \r\n    // Cancel button\r\n    const cancelButton = getTargetDocument().createElement('button');\r\n    cancelButton.textContent = 'Cancel';\r\n    cancelButton.style.cssText = `\r\n      padding: ${theme.spacing.s} ${theme.spacing.l};\r\n      background: ${theme.colors.modal.secondary};\r\n      border: 1px solid ${theme.colors.modal.secondaryBorder};\r\n      border-radius: ${theme.borderRadius.small};\r\n      color: ${theme.colors.modal.secondaryText};\r\n      font-size: ${theme.typography.fontSize.body};\r\n      font-weight: ${theme.typography.fontWeight.semibold};\r\n      font-family: ${theme.typography.fontFamily};\r\n      cursor: pointer;\r\n      transition: all 0.2s;\r\n    `;\r\n    cancelButton.onmouseover = () => cancelButton.style.background = theme.colors.modal.secondaryHover;\r\n    cancelButton.onmouseout = () => cancelButton.style.background = theme.colors.modal.secondary;\r\n    cancelButton.onclick = () => this.cancel();\r\n    \r\n    footer.appendChild(cancelButton);\r\n    \r\n    // Clear button (if multi-select and allowClear)\r\n    if (this.options.multiSelect && this.options.allowClear) {\r\n      const clearButton = getTargetDocument().createElement('button');\r\n      clearButton.textContent = 'Clear Selection';\r\n      clearButton.style.cssText = `\r\n        padding: ${theme.spacing.s} ${theme.spacing.l};\r\n        background: ${theme.colors.modal.secondary};\r\n        border: 1px solid ${theme.colors.modal.secondaryBorder};\r\n        border-radius: ${theme.borderRadius.small};\r\n        color: ${theme.colors.modal.secondaryText};\r\n        font-size: ${theme.typography.fontSize.body};\r\n        font-weight: ${theme.typography.fontWeight.semibold};\r\n        font-family: ${theme.typography.fontFamily};\r\n        cursor: pointer;\r\n        transition: all 0.2s;\r\n      `;\r\n      clearButton.onmouseover = () => clearButton.style.background = theme.colors.modal.secondaryHover;\r\n      clearButton.onmouseout = () => clearButton.style.background = theme.colors.modal.secondary;\r\n      clearButton.onclick = () => this.clearSelection();\r\n      \r\n      footer.appendChild(clearButton);\r\n    }\r\n    \r\n    // Select button\r\n    const selectButton = getTargetDocument().createElement('button');\r\n    selectButton.textContent = 'Select';\r\n    selectButton.style.cssText = `\r\n      padding: ${theme.spacing.s} ${theme.spacing.l};\r\n      background: ${theme.colors.modal.primary};\r\n      border: none;\r\n      border-radius: ${theme.borderRadius.small};\r\n      color: ${theme.colors.modal.primaryText};\r\n      font-size: ${theme.typography.fontSize.body};\r\n      font-weight: ${theme.typography.fontWeight.semibold};\r\n      font-family: ${theme.typography.fontFamily};\r\n      cursor: pointer;\r\n      transition: all 0.2s;\r\n    `;\r\n    selectButton.onmouseover = () => selectButton.style.background = theme.colors.modal.primaryHover;\r\n    selectButton.onmouseout = () => selectButton.style.background = theme.colors.modal.primary;\r\n    selectButton.onclick = () => this.select();\r\n    \r\n    footer.appendChild(selectButton);\r\n    \r\n    return footer;\r\n  }\r\n  \r\n  private async loadColumnLabels(): Promise<void> {\r\n    const metadata = await getEntityMetadata(this.options.entity);\r\n    \r\n    // Use provided labels first\r\n    if (this.options.columnLabels) {\r\n      Object.entries(this.options.columnLabels).forEach(([key, value]) => {\r\n        this.columnLabels.set(key, value);\r\n      });\r\n    }\r\n    \r\n    // Fill in missing labels from metadata or use logical name\r\n    this.options.columns.forEach(column => {\r\n      if (!this.columnLabels.has(column)) {\r\n        const attr = metadata?.Attributes?.find(a => a.LogicalName === column);\r\n        const label = attr?.DisplayName?.UserLocalizedLabel?.Label || column;\r\n        this.columnLabels.set(column, label);\r\n      }\r\n    });\r\n  }\r\n  \r\n  private handleScroll(): void {\r\n    if (!this.tableContainer || this.isLoadingMore || !this.hasMoreRecords) return;\r\n    \r\n    const { scrollTop, scrollHeight, clientHeight } = this.tableContainer;\r\n    const scrollPercentage = (scrollTop + clientHeight) / scrollHeight;\r\n    \r\n    // Load more when scrolled 80% down\r\n    if (scrollPercentage > 0.8) {\r\n      this.loadMoreRecords();\r\n    }\r\n  }\r\n  \r\n  private async loadMoreRecords(): Promise<void> {\r\n    if (this.isLoadingMore || !this.hasMoreRecords) return;\r\n    \r\n    this.isLoadingMore = true;\r\n    this.currentPage++;\r\n    \r\n    try {\r\n      const orderBy = this.sortColumn \r\n        ? [{ attribute: this.sortColumn, descending: this.sortDescending }]\r\n        : this.options.orderBy;\r\n      \r\n      const searchTerm = this.searchInput?.value.trim() || '';\r\n      const allSearchFields = [\r\n        ...this.options.searchFields,\r\n        ...this.options.additionalSearchFields\r\n      ];\r\n      \r\n      const result = await fetchRecords(\r\n        this.options.entity,\r\n        this.options.columns,\r\n        this.options.filters,\r\n        orderBy,\r\n        this.currentPage,\r\n        this.options.pageSize,\r\n        searchTerm,\r\n        allSearchFields\r\n      );\r\n      \r\n      if (result.entities.length === 0) {\r\n        this.hasMoreRecords = false;\r\n      } else {\r\n        this.allLoadedRecords.push(...result.entities);\r\n        this.records = this.allLoadedRecords;\r\n        this.renderTableRows();\r\n      }\r\n    } catch (error) {\r\n      console.error('Failed to load more records:', error);\r\n    } finally {\r\n      this.isLoadingMore = false;\r\n    }\r\n  }\r\n  \r\n  private async loadData(): Promise<void> {\r\n    try {\r\n      // Reset for fresh load\r\n      this.currentPage = 1;\r\n      this.allLoadedRecords = [];\r\n      this.hasMoreRecords = true;\r\n      \r\n      const orderBy = this.sortColumn \r\n        ? [{ attribute: this.sortColumn, descending: this.sortDescending }]\r\n        : this.options.orderBy;\r\n      \r\n      const searchTerm = this.searchInput?.value.trim() || '';\r\n      const allSearchFields = [\r\n        ...this.options.searchFields,\r\n        ...this.options.additionalSearchFields\r\n      ];\r\n      \r\n      const result = await fetchRecords(\r\n        this.options.entity,\r\n        this.options.columns,\r\n        this.options.filters,\r\n        orderBy,\r\n        this.currentPage,\r\n        this.options.pageSize,\r\n        searchTerm,\r\n        allSearchFields\r\n      );\r\n      \r\n      this.allLoadedRecords = result.entities;\r\n      this.records = this.allLoadedRecords;\r\n      this.totalRecords = result.totalCount;\r\n      \r\n      this.renderTableRows();\r\n      this.updatePagination();\r\n    } catch (error) {\r\n      console.error('Failed to load lookup data:', error);\r\n    }\r\n  }\r\n  \r\n  private renderTableRows(): void {\r\n    if (!this.tableBody) return;\r\n    \r\n    this.tableBody.innerHTML = '';\r\n    \r\n    const metadata = metadataCache.get(this.options.entity);\r\n    const primaryIdAttr = metadata?.PrimaryIdAttribute || `${this.options.entity}id`;\r\n    \r\n    this.records.forEach((record, index) => {\r\n      const row = getTargetDocument().createElement('tr');\r\n      row.style.cssText = `\r\n        cursor: pointer;\r\n        transition: background 0.2s;\r\n      `;\r\n      \r\n      const recordId = record[primaryIdAttr];\r\n      const isSelected = this.selectedRecords.has(recordId);\r\n      \r\n      if (isSelected) {\r\n        row.style.background = theme.colors.neutralLighter;\r\n      }\r\n      \r\n      row.onmouseover = () => {\r\n        if (!isSelected) {\r\n          row.style.background = theme.colors.neutralLighterAlt;\r\n        }\r\n      };\r\n      \r\n      row.onmouseout = () => {\r\n        if (!isSelected) {\r\n          row.style.background = index % 2 === 0 ? 'white' : theme.colors.neutralLighterAlt;\r\n        }\r\n      };\r\n      \r\n      row.onclick = (e) => {\r\n        if ((e.target as HTMLElement).tagName !== 'INPUT') {\r\n          this.toggleSelection(recordId);\r\n        }\r\n      };\r\n      \r\n      // Checkbox column\r\n      if (this.options.multiSelect) {\r\n        const td = getTargetDocument().createElement('td');\r\n        td.style.cssText = `\r\n          padding: ${theme.spacing.s};\r\n          border-bottom: 1px solid ${theme.colors.modal.divider};\r\n        `;\r\n        \r\n        const checkbox = getTargetDocument().createElement('input');\r\n        checkbox.type = 'checkbox';\r\n        checkbox.checked = isSelected;\r\n        checkbox.onchange = () => this.toggleSelection(recordId);\r\n        \r\n        td.appendChild(checkbox);\r\n        row.appendChild(td);\r\n      }\r\n      \r\n      // Data columns\r\n      this.options.columns.forEach(column => {\r\n        const td = getTargetDocument().createElement('td');\r\n        td.style.cssText = `\r\n          padding: ${theme.spacing.s};\r\n          border-bottom: 1px solid ${theme.colors.modal.divider};\r\n          color: ${theme.colors.modal.text};\r\n        `;\r\n        \r\n        const value = record[column];\r\n        td.textContent = formatValue(value);\r\n        \r\n        row.appendChild(td);\r\n      });\r\n      \r\n      this.tableBody!.appendChild(row);\r\n    });\r\n    \r\n    // Empty state\r\n    if (this.records.length === 0) {\r\n      const row = getTargetDocument().createElement('tr');\r\n      const td = getTargetDocument().createElement('td');\r\n      td.colSpan = this.options.columns.length + (this.options.multiSelect ? 1 : 0);\r\n      td.style.cssText = `\r\n        padding: ${theme.spacing.xl};\r\n        text-align: center;\r\n        color: ${theme.colors.modal.textSecondary};\r\n      `;\r\n      td.textContent = 'No records found';\r\n      row.appendChild(td);\r\n      this.tableBody!.appendChild(row);\r\n    }\r\n  }\r\n  \r\n  private toggleSelection(recordId: string): void {\r\n    if (this.options.multiSelect) {\r\n      if (this.selectedRecords.has(recordId)) {\r\n        this.selectedRecords.delete(recordId);\r\n      } else {\r\n        this.selectedRecords.add(recordId);\r\n      }\r\n    } else {\r\n      this.selectedRecords.clear();\r\n      this.selectedRecords.add(recordId);\r\n    }\r\n    \r\n    this.renderTableRows();\r\n  }\r\n  \r\n  private clearSelection(): void {\r\n    this.selectedRecords.clear();\r\n    this.options.onSelect([]);\r\n    this.close();\r\n  }\r\n  \r\n  private handleSearch(): void {\r\n    clearTimeout(this.searchDebounceTimer);\r\n    \r\n    this.searchDebounceTimer = window.setTimeout(() => {\r\n      this.currentPage = 1;\r\n      this.loadData();\r\n    }, 300);\r\n  }\r\n  \r\n  private handleSort(column: string): void {\r\n    if (this.sortColumn === column) {\r\n      this.sortDescending = !this.sortDescending;\r\n    } else {\r\n      this.sortColumn = column;\r\n      this.sortDescending = false;\r\n    }\r\n    \r\n    this.loadData();\r\n  }\r\n  \r\n  private updatePagination(): void {\r\n    if (!this.options.showPagination) return;\r\n    \r\n    if (this.paginationInfo) {\r\n      const loadedCount = this.allLoadedRecords.length;\r\n      if (this.hasMoreRecords) {\r\n        this.paginationInfo.textContent = `Showing ${loadedCount} of ${this.totalRecords} records (scroll for more)`;\r\n      } else {\r\n        this.paginationInfo.textContent = `Showing all ${loadedCount} records`;\r\n      }\r\n    }\r\n  }\r\n  \r\n  private select(): void {\r\n    const metadata = metadataCache.get(this.options.entity);\r\n    const primaryIdAttr = metadata?.PrimaryIdAttribute || `${this.options.entity}id`;\r\n    const primaryNameAttr = metadata?.PrimaryNameAttribute || 'name';\r\n    \r\n    const selectedResults: LookupResult[] = Array.from(this.selectedRecords).map(id => {\r\n      const record = this.records.find(r => r[primaryIdAttr] === id);\r\n      if (!record) return null;\r\n      \r\n      return {\r\n        id: record[primaryIdAttr],\r\n        name: record[primaryNameAttr] || record.name || '',\r\n        entityType: this.options.entity,\r\n        attributes: record\r\n      };\r\n    }).filter((r): r is LookupResult => r !== null);\r\n    \r\n    this.options.onSelect(selectedResults);\r\n    this.close();\r\n  }\r\n  \r\n  private cancel(): void {\r\n    this.options.onCancel();\r\n    this.close();\r\n  }\r\n  \r\n  private close(): void {\r\n    // Animate out\r\n    this.modal.style.animation = 'fadeOutScale 0.2s ease-in';\r\n    this.overlay.style.animation = 'fadeOut 0.2s ease-in';\r\n    \r\n    setTimeout(() => {\r\n      if (this.container.parentElement) {\r\n        this.container.parentElement.removeChild(this.container);\r\n      }\r\n      if (this.overlay.parentElement) {\r\n        this.overlay.parentElement.removeChild(this.overlay);\r\n      }\r\n      \r\n      Lookup.activeInstance = null;\r\n    }, 200);\r\n  }\r\n  \r\n  private show(): void {\r\n    const doc = getTargetDocument();\r\n    doc.body.appendChild(this.overlay);\r\n    doc.body.appendChild(this.container);\r\n  }\r\n  \r\n  static open(options: LookupOptions): void {\r\n    // Close any existing lookup\r\n    if (Lookup.activeInstance) {\r\n      Lookup.activeInstance.close();\r\n    }\r\n    \r\n    const lookup = new Lookup(options);\r\n    Lookup.activeInstance = lookup;\r\n    lookup.show();\r\n  }\r\n}\r\n","/**\r\n * Logger utility for debugging\r\n * Provides colored console output for different log levels\r\n */\r\n\r\nexport const BUG = [\r\n  '%c BUG ',\r\n  'background: #9C27B0; color: white; font-weight: bold; padding: 2px 6px; border-radius: 3px;'\r\n];\r\n\r\nexport const WAR = [\r\n  '%c WAR ',\r\n  'background: #FF9800; color: white; font-weight: bold; padding: 2px 6px; border-radius: 3px;'\r\n];\r\n\r\nexport const ERR = [\r\n  '%c ERR ',\r\n  'background: #F44336; color: white; font-weight: bold; padding: 2px 6px; border-radius: 3px;'\r\n];\r\n\r\nexport const Logger = {\r\n  BUG,\r\n  WAR,\r\n  ERR\r\n};\r\n","/**\r\n * Modal Field Helper Classes\r\n * Provides convenient constructors for modal fields\r\n */\r\n\r\nimport type { FieldConfig } from './Modal.types';\r\n\r\n/**\r\n * Input field helper\r\n */\r\nexport class Input implements FieldConfig {\r\n  id: string;\r\n  label?: string;\r\n  type?: string;\r\n  value?: any;\r\n  placeholder?: string;\r\n  disabled?: boolean;\r\n  required?: boolean;\r\n  divider?: boolean;\r\n  extraAttributes?: Record<string, string | number>;\r\n  showValue?: boolean;\r\n  validation?: any;\r\n\r\n  constructor(config: FieldConfig) {\r\n    this.id = config.id;\r\n    this.label = config.label;\r\n    this.type = config.type || 'text';\r\n    this.value = config.value;\r\n    this.placeholder = config.placeholder;\r\n    this.disabled = config.disabled;\r\n    this.required = config.required;\r\n    this.divider = config.divider;\r\n    this.extraAttributes = config.extraAttributes;\r\n    this.showValue = config.showValue;\r\n    this.validation = config.validation;\r\n  }\r\n}\r\n\r\n/**\r\n * MultiLine (textarea) field helper\r\n */\r\nexport class MultiLine implements FieldConfig {\r\n  id: string;\r\n  label?: string;\r\n  type: string = 'textarea';\r\n  value?: any;\r\n  placeholder?: string;\r\n  disabled?: boolean;\r\n  required?: boolean;\r\n  rows?: number;\r\n  divider?: boolean;\r\n\r\n  constructor(config: FieldConfig) {\r\n    this.id = config.id;\r\n    this.label = config.label;\r\n    this.value = config.value;\r\n    this.placeholder = config.placeholder;\r\n    this.disabled = config.disabled;\r\n    this.required = config.required;\r\n    this.rows = config.rows || 4;\r\n    this.divider = config.divider;\r\n  }\r\n}\r\n\r\n/**\r\n * OptionSet (dropdown/select) field helper\r\n */\r\nexport class OptionSet implements FieldConfig {\r\n  id: string;\r\n  label?: string;\r\n  type: string = 'select';\r\n  value?: any;\r\n  disabled?: boolean;\r\n  required?: boolean;\r\n  options?: Array<string | { label: string; value: string }>;\r\n  multiSelect?: boolean;\r\n  divider?: boolean;\r\n\r\n  constructor(config: FieldConfig) {\r\n    this.id = config.id;\r\n    this.label = config.label;\r\n    this.value = config.value;\r\n    this.disabled = config.disabled;\r\n    this.required = config.required;\r\n    this.options = config.options || [];\r\n    this.multiSelect = config.multiSelect || false;\r\n    this.divider = config.divider;\r\n  }\r\n}\r\n\r\n/**\r\n * DateRange field helper\r\n */\r\nexport class DateRange implements FieldConfig {\r\n  id: string;\r\n  label?: string;\r\n  type: string = 'daterange';\r\n  startDate?: Date;\r\n  endDate?: Date;\r\n  required?: boolean;\r\n  disabled?: boolean;\r\n  divider?: boolean;\r\n\r\n  constructor(config: FieldConfig) {\r\n    this.id = config.id;\r\n    this.label = config.label;\r\n    this.startDate = config.startDate;\r\n    this.endDate = config.endDate;\r\n    this.required = config.required;\r\n    this.disabled = config.disabled;\r\n    this.divider = config.divider;\r\n  }\r\n}\r\n\r\n/**\r\n * Lookup field helper\r\n */\r\nexport class Lookup implements FieldConfig {\r\n  id: string;\r\n  label?: string;\r\n  type: string = 'lookup';\r\n  entityTypes?: string[];\r\n  allowMultiSelect?: boolean;\r\n  callback?: (selected: any[]) => void;\r\n  required?: boolean;\r\n  disabled?: boolean;\r\n  divider?: boolean;\r\n\r\n  constructor(config: FieldConfig) {\r\n    this.id = config.id;\r\n    this.label = config.label;\r\n    this.entityTypes = config.entityTypes || [];\r\n    this.allowMultiSelect = config.allowMultiSelect || false;\r\n    this.callback = config.callback;\r\n    this.required = config.required;\r\n    this.disabled = config.disabled;\r\n    this.divider = config.divider;\r\n  }\r\n}\r\n\r\n/**\r\n * Custom field helper\r\n */\r\nexport class Custom implements FieldConfig {\r\n  id: string;\r\n  label?: string;\r\n  type: string = 'custom';\r\n  render?: () => HTMLElement;\r\n  html?: string;\r\n  divider?: boolean;\r\n\r\n  constructor(config: FieldConfig) {\r\n    this.id = config.id;\r\n    this.label = config.label;\r\n    this.render = config.render;\r\n    this.html = config.html;\r\n    this.divider = config.divider;\r\n  }\r\n}\r\n\r\n/**\r\n * Group field helper (for organizing fields, optionally as tabs)\r\n */\r\nexport class Group implements FieldConfig {\r\n  id: string;\r\n  label?: string;\r\n  type: string = 'group';\r\n  fields?: FieldConfig[];\r\n  asTabs?: boolean;\r\n  divider?: boolean;\r\n\r\n  constructor(config: FieldConfig) {\r\n    this.id = config.id;\r\n    this.label = config.label;\r\n    this.fields = config.fields || [];\r\n    this.asTabs = config.asTabs || false;\r\n    this.divider = config.divider;\r\n  }\r\n}\r\n","/**\r\n * err403 UI Library - Main Entry Point\r\n * D365 CE UI Utilities Library\r\n */\r\n\r\nimport { Toast } from './components/Toast/Toast';\r\nimport { Modal } from './components/Modal/Modal';\r\nimport { ModalButton } from './components/Modal/Modal.types';\r\nimport * as ModalHelpers from './components/Modal/ModalHelpers';\r\nimport { Lookup } from './components/Lookup/Lookup';\r\nimport { Logger, BUG, WAR, ERR } from './components/Logger/Logger';\r\nimport { theme } from './styles/theme';\r\nimport {\r\n    Input,\r\n    MultiLine,\r\n    OptionSet,\r\n    DateRange,\r\n    Lookup as LookupField,\r\n    Custom,\r\n    Group\r\n} from './components/Modal/ModalFields';\r\n\r\n/**\r\n * D365 Form OnLoad Handler\r\n * This function is called by D365 when the form loads\r\n * @param executionContext - The execution context from D365\r\n */\r\nexport function init(executionContext?: any): void {\r\n    console.log('err403 UI Library initialized', { executionContext });\r\n}\r\n\r\n/**\r\n * D365 Form OnLoad Handler (alias)\r\n */\r\nexport function onLoad(executionContext?: any): void {\r\n    init(executionContext);\r\n}\r\n\r\n// Export all components (named exports)\r\nexport {\r\n    Toast,\r\n    Modal,\r\n    ModalButton,\r\n    ModalButton as Button, // Alias for convenience\r\n    ModalHelpers,\r\n    Lookup,\r\n    Logger,\r\n    BUG,\r\n    WAR,\r\n    ERR,\r\n    theme,\r\n    // Field helper classes\r\n    Input,\r\n    MultiLine,\r\n    OptionSet,\r\n    DateRange,\r\n    LookupField,\r\n    Custom,\r\n    Group\r\n};\r\n\r\n// D365 iframe support - expose library to parent window\r\nif (typeof window !== 'undefined') {\r\n    // Create the library object\r\n    const err403Library = {\r\n        init,\r\n        onLoad,\r\n        Toast,\r\n        Modal,\r\n        ModalButton,\r\n        ModalHelpers,\r\n        Lookup,\r\n        Logger,\r\n        BUG,\r\n        WAR,\r\n        ERR,\r\n        theme,\r\n        // Field helper classes\r\n        Input,\r\n        MultiLine,\r\n        OptionSet,\r\n        DateRange,\r\n        LookupField,\r\n        Custom,\r\n        Group,\r\n        // Alias Button for ModalButton\r\n        Button: ModalButton\r\n    };\r\n\r\n    // Expose to current window (iframe)\r\n    (window as any).err403 = err403Library;\r\n\r\n    // Expose to parent window if in iframe\r\n    try {\r\n        if (window.parent && window.parent !== window) {\r\n            (window.parent as any).err403 = err403Library;\r\n        }\r\n\r\n        // Also expose to top window for D365\r\n        if (window.top && window.top !== window) {\r\n            (window.top as any).err403 = err403Library;\r\n        }\r\n    } catch (e) {\r\n        // Cross-origin iframe - can't access parent\r\n        console.warn('err403: Running in cross-origin iframe, library only available in current frame');\r\n    }\r\n}\r\n"],"names":["theme","colors","primary","primaryHover","primaryPressed","success","error","warning","info","neutralPrimary","neutralSecondary","neutralTertiary","neutralLight","neutralLighter","neutralLighterAlt","white","toast","bg","border","text","warn","default","modal","background","textSecondary","overlay","headerBackground","footerBackground","divider","primaryText","secondary","secondaryBorder","secondaryText","secondaryHover","secondaryPressed","danger","dangerHover","dangerPressed","dangerText","inputBackground","inputBorder","inputBorderBottom","inputBorderHover","inputBorderFocus","inputText","inputPlaceholder","inputDisabled","tabBorder","tabActive","tabActiveBorder","tabInactive","tabInactiveBorder","tabHover","tabBackground","tabSelectedBackground","progress","bar","barBackground","stepActive","stepCompleted","stepPending","stepText","stepBorder","sideCart","shadows","dropdown","card","depth8","depth16","depth64","borderRadius","none","small","medium","large","circular","typography","fontFamily","fontSize","caption","body","subtitle","title","xLarge","fontWeight","regular","semibold","bold","lineHeight","spacing","xxs","xs","sNudge","s","mNudge","m","l","xl","xxl","xxxl","zIndex","modalOverlay","animations","slideInRight","slideOutRight","fadeInScale","fadeOutScale","fadeIn","fadeOut","spin","progressFill","injectAnimations","styleId","document","getElementById","style","createElement","id","textContent","Object","values","join","head","appendChild","getToastContainer","container","existing","cssText","window","parent","createToast","options","type","message","duration","sound","className","iconDiv","innerHTML","getToastIcon","content","titleDiv","messageDiv","closeBtn","onmouseover","opacity","onmouseout","transform","instance","element","show","audioContext","AudioContext","webkitAudioContext","oscillator","createOscillator","gainNode","createGain","connect","destination","frequency","value","gain","setValueAtTime","currentTime","exponentialRampToValueAtTime","start","stop","e","playNotificationSound","setTimeout","this","close","animation","parentElement","removeChild","onclick","target","stopPropagation","Toast","titleOrOptions","ModalButton","constructor","label","callback","setFocus","preventClose","isDestructive","getTargetDocument","self","top","Modal$1","Modal","header","footer","loadingOverlay","resolvePromise","fieldValues","Map","currentStep","isDragging","dragStartX","dragStartY","modalStartX","modalStartY","handleDrag","deltaX","clientX","deltaY","clientY","newX","newY","left","margin","stopDrag","doc","removeEventListener","handleEscapeKey","key","allowEscapeClose","allowDismiss","draggable","buttonAlignment","autoSave","size","createModal","width","height","getModalDimensions","createHeader","createBody","createFooter","enabled","isAttached","attached","modalWrapper","position","createSideCart","addEventListener","sizeMap","fullscreen","innerWidth","innerHeight","titleEl","setAttribute","color","onmousedown","startDrag","needsSectionStyling","fields","length","messageEl","contentEl","fieldsContainer","forEach","field","fieldEl","createField","cartWidth","backgroundColor","imageUrl","img","src","createTabs","tabs","tabsContainer","tabHeadersWrapper","tabHeaders","tabContents","tabContentElements","tab","index","tabHeaderLi","underline","tabContent","push","display","Array","from","children","headerEl","underlineEl","querySelector","textWidth","offsetWidth","maxHeight","originalDisplay","scrollHeight","minHeight","asTabs","render","html","labelPosition","required","input","rows","opt","option","placeholder","needsAnimatedBorder","inputWrapper","borderElement","onfocus","onblur","HTMLInputElement","checked","Boolean","String","set","oninput","alignment","justifyContent","buttons","btn","button","createButton","isPrimary","async","data","getFieldValues","focus","rect","getBoundingClientRect","preventDefault","overflow","showAsync","Promise","resolve","setLoading","loading","spinner","updateProgress","step","_skipValidation","nextStep","previousStep","goToStep","_stepId","getFieldValue","fieldId","get","validateCurrentStep","validateAllFields","updateSideCart","_content","clearAutoSave","getElement","selector","elements","querySelectorAll","open","alert","confirm","showWebResource","webResourcePath","iframe","baseUrl","location","origin","fullUrl","startsWith","icon","defaultValue","metadataCache","fetchRecords","entity","columns","filters","orderBy","pageNumber","pageSize","searchTerm","searchFields","Xrm","WebApi","retrieveMultipleRecords","allColumns","Set","fetchXml","col","combinedFilters","searchFilter","order","attribute","descending","result","encodeURIComponent","entities","totalCount","parseInt","console","log","allMockData","count","mockData","firstNames","lastNames","companies","cities","i","padStart","company","accountid","name","trim","accountnumber","telephone1","Math","floor","random","emailaddress1","toLowerCase","replace","address1_city","revenue","websiteurl","createdon","Date","now","toISOString","firstName","lastName","contactid","fullname","firstname","lastname","jobtitle","parentcustomerid","charAt","toUpperCase","slice","generateMockData","filteredData","lowerSearch","filter","record","some","includes","sort","a","b","aVal","bVal","comparison","end","Lookup$1","_a","tableContainer","tableBody","searchInput","paginationInfo","currentPage","totalRecords","records","allLoadedRecords","selectedRecords","searchDebounceTimer","columnLabels","sortColumn","sortDescending","isLoadingMore","hasMoreRecords","multiSelect","additionalSearchFields","defaultSearchTerm","showPagination","allowClear","onSelect","onCancel","searchBar","createSearchBar","createTableContainer","pagination","createPagination","loadColumnLabels","loadData","closeButton","cancel","searchIcon","transitionDuration","transitionDelay","handleSearch","onscroll","handleScroll","table","thead","headerRow","th","column","handleSort","cancelButton","clearButton","clearSelection","selectButton","select","metadata","entityName","has","Utility","getEntityMetadata","mockMetadata","EntitySetName","PrimaryIdAttribute","PrimaryNameAttribute","DisplayName","UserLocalizedLabel","Label","Attributes","entries","attr","find","LogicalName","scrollTop","clientHeight","loadMoreRecords","allSearchFields","renderTableRows","updatePagination","primaryIdAttr","row","recordId","isSelected","tagName","toggleSelection","td","checkbox","onchange","test","date","toLocaleDateString","toLocaleTimeString","toLocaleString","_value","formatValue","colSpan","delete","add","clear","clearTimeout","loadedCount","primaryNameAttr","selectedResults","map","r","entityType","attributes","activeInstance","lookup","BUG","WAR","ERR","Logger","Input","config","disabled","extraAttributes","showValue","validation","MultiLine","OptionSet","DateRange","startDate","endDate","Lookup","entityTypes","allowMultiSelect","Custom","Group","init","executionContext","onLoad","err403Library","ModalHelpers","LookupField","Button","err403"],"mappings":"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"}